<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>27&nbsp; Multi-Factor ANOVA – Statistics for the Biosciences and Bioengineering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/27-glm.html" rel="next">
<link href="../chapters/25-single-factor-anova.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/19-what-are-models.html">Linear Models</a></li><li class="breadcrumb-item"><a href="../chapters/26-multifactor-anova.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Multi-Factor ANOVA</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistics for the Biosciences and Bioengineering</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Why This Book?</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Core Data Science Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-installing-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Installing Core Tools</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-unix-command-line.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Unix and the Command Line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-r-rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-markdown-latex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Markdown and LaTeX</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Exploration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-tidy-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tidy Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-data-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling with dplyr</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-data-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Probability and Distributions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-probability-foundations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Foundations of Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-discrete-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Discrete Probability Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-continuous-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Continuous Probability Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-sampling-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Sampling and Parameter Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-experimental-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Experimental Design Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-hypothesis-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/16-t-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">T-Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/17-nonparametric-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Nonparametric Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/18-bootstrapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Resampling Methods</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/19-what-are-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">What are Models?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/20-correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Correlation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/21-simple-linear-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Simple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/22-residual-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Residual Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/23-statistical-power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Statistical Power</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/24-multiple-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Multiple Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/25-single-factor-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Single Factor ANOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/26-multifactor-anova.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Multi-Factor ANOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/27-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/28-intro-statistical-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Introduction to Statistical Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/29-model-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Model Validation and the Bias-Variance Tradeoff</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/30-regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Regularization Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/31-smoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Smoothing and Non-Parametric Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/32-classification-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Classification and Performance Metrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/33-trees-forests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Decision Trees and Random Forests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/34-svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Support Vector Machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/35-clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Clustering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/36-dimensionality-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Dimensionality Reduction and Multivariate Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/37-tsne-umap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Non-Linear Dimensionality Reduction: t-SNE and UMAP</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/38-bayesian-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Bayesian Statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/39-deep-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">Introduction to Deep Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/40-high-performance-computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">High Performance Computing</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Scientific Communication</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/41-presenting-results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Presenting Statistical Results</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Historical Context</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-eugenics-history.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">The Eugenics History of Statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-keyboard-shortcuts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Keyboard Shortcuts Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-unix-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Unix Command Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-r-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">R Command Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-quarto-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Quarto Markdown Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-latex-reference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">LaTeX Command Reference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A7-greek-letters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Greek Letters in Mathematics and Statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A8-probability-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Common Probability Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A9-sampling-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Sampling Distributions in Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A10-matrix-algebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Matrix Algebra Fundamentals</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-to-factorial-designs" id="toc-introduction-to-factorial-designs" class="nav-link active" data-scroll-target="#introduction-to-factorial-designs"><span class="header-section-number">27.1</span> Introduction to Factorial Designs</a></li>
  <li><a href="#two-way-anova" id="toc-two-way-anova" class="nav-link" data-scroll-target="#two-way-anova"><span class="header-section-number">27.2</span> Two-Way ANOVA</a></li>
  <li><a href="#understanding-interactions" id="toc-understanding-interactions" class="nav-link" data-scroll-target="#understanding-interactions"><span class="header-section-number">27.3</span> Understanding Interactions</a>
  <ul class="collapse">
  <li><a href="#interaction-plots" id="toc-interaction-plots" class="nav-link" data-scroll-target="#interaction-plots">Interaction Plots</a></li>
  </ul></li>
  <li><a href="#interpreting-main-effects-vs-interactions" id="toc-interpreting-main-effects-vs-interactions" class="nav-link" data-scroll-target="#interpreting-main-effects-vs-interactions"><span class="header-section-number">27.4</span> Interpreting Main Effects vs Interactions</a></li>
  <li><a href="#ancova-analysis-of-covariance" id="toc-ancova-analysis-of-covariance" class="nav-link" data-scroll-target="#ancova-analysis-of-covariance"><span class="header-section-number">27.5</span> ANCOVA: Analysis of Covariance</a>
  <ul class="collapse">
  <li><a href="#the-ancova-model" id="toc-the-ancova-model" class="nav-link" data-scroll-target="#the-ancova-model">The ANCOVA Model</a></li>
  <li><a href="#fitting-ancova-in-r" id="toc-fitting-ancova-in-r" class="nav-link" data-scroll-target="#fitting-ancova-in-r">Fitting ANCOVA in R</a></li>
  <li><a href="#adjusted-means" id="toc-adjusted-means" class="nav-link" data-scroll-target="#adjusted-means">Adjusted Means</a></li>
  <li><a href="#testing-homogeneity-of-slopes" id="toc-testing-homogeneity-of-slopes" class="nav-link" data-scroll-target="#testing-homogeneity-of-slopes">Testing Homogeneity of Slopes</a></li>
  <li><a href="#when-to-use-ancova" id="toc-when-to-use-ancova" class="nav-link" data-scroll-target="#when-to-use-ancova">When to Use ANCOVA</a></li>
  </ul></li>
  <li><a href="#nested-designs" id="toc-nested-designs" class="nav-link" data-scroll-target="#nested-designs"><span class="header-section-number">27.6</span> Nested Designs</a></li>
  <li><a href="#repeated-measures-anova" id="toc-repeated-measures-anova" class="nav-link" data-scroll-target="#repeated-measures-anova"><span class="header-section-number">27.7</span> Repeated Measures ANOVA</a></li>
  <li><a href="#mixed-effects-models" id="toc-mixed-effects-models" class="nav-link" data-scroll-target="#mixed-effects-models"><span class="header-section-number">27.8</span> Mixed Effects Models</a></li>
  <li><a href="#split-plot-designs" id="toc-split-plot-designs" class="nav-link" data-scroll-target="#split-plot-designs"><span class="header-section-number">27.9</span> Split-Plot Designs</a></li>
  <li><a href="#practical-considerations-for-complex-designs" id="toc-practical-considerations-for-complex-designs" class="nav-link" data-scroll-target="#practical-considerations-for-complex-designs"><span class="header-section-number">27.10</span> Practical Considerations for Complex Designs</a>
  <ul class="collapse">
  <li><a href="#sample-size-and-power" id="toc-sample-size-and-power" class="nav-link" data-scroll-target="#sample-size-and-power">Sample Size and Power</a></li>
  <li><a href="#balanced-vs-unbalanced-designs" id="toc-balanced-vs-unbalanced-designs" class="nav-link" data-scroll-target="#balanced-vs-unbalanced-designs">Balanced vs Unbalanced Designs</a></li>
  <li><a href="#effect-sizes-in-multi-factor-anova" id="toc-effect-sizes-in-multi-factor-anova" class="nav-link" data-scroll-target="#effect-sizes-in-multi-factor-anova">Effect Sizes in Multi-Factor ANOVA</a></li>
  <li><a href="#multiple-comparisons" id="toc-multiple-comparisons" class="nav-link" data-scroll-target="#multiple-comparisons">Multiple Comparisons</a></li>
  <li><a href="#model-assumptions" id="toc-model-assumptions" class="nav-link" data-scroll-target="#model-assumptions">Model Assumptions</a></li>
  <li><a href="#reporting-results" id="toc-reporting-results" class="nav-link" data-scroll-target="#reporting-results">Reporting Results</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">27.11</span> Summary</a></li>
  <li><a href="#practice-exercises" id="toc-practice-exercises" class="nav-link" data-scroll-target="#practice-exercises"><span class="header-section-number">27.12</span> Practice Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/19-what-are-models.html">Linear Models</a></li><li class="breadcrumb-item"><a href="../chapters/26-multifactor-anova.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Multi-Factor ANOVA</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-multifactor-anova" class="quarto-section-identifier"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Multi-Factor ANOVA</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-to-factorial-designs" class="level2" data-number="27.1">
<h2 data-number="27.1" class="anchored" data-anchor-id="introduction-to-factorial-designs"><span class="header-section-number">27.1</span> Introduction to Factorial Designs</h2>
<p>While one-way ANOVA compares groups defined by a single factor, many biological experiments manipulate multiple factors simultaneously. A factorial design examines all combinations of factor levels, allowing us to study not only the independent effect of each factor but also how factors interact with each other.</p>
<p>Consider an experiment testing the effects of both temperature and nutrient concentration on algal growth. A factorial design would include all combinations: high temperature with high nutrients, high temperature with low nutrients, low temperature with high nutrients, and low temperature with low nutrients. This approach is more efficient than conducting separate experiments for each factor, and it reveals interactions that single-factor designs would miss.</p>
<p><strong>Factorial designs</strong> are characterized by: - Multiple factors (independent variables) - All combinations of factor levels are tested - Ability to test for interactions between factors - Greater efficiency than separate one-factor experiments</p>
<p>The notation <span class="math inline">\(a \times b\)</span> factorial design means factor A has <span class="math inline">\(a\)</span> levels and factor B has <span class="math inline">\(b\)</span> levels, producing <span class="math inline">\(a \times b\)</span> treatment combinations. A <span class="math inline">\(2 \times 3\)</span> design has 6 treatment groups; a <span class="math inline">\(2 \times 2 \times 2\)</span> design has 8 treatment groups.</p>
</section>
<section id="two-way-anova" class="level2" data-number="27.2">
<h2 data-number="27.2" class="anchored" data-anchor-id="two-way-anova"><span class="header-section-number">27.2</span> Two-Way ANOVA</h2>
<p>Two-way ANOVA analyzes data from a two-factor experimental design. The model partitions variance into:</p>
<ol type="1">
<li><strong>Main effect of Factor A</strong>: The average effect of Factor A across all levels of Factor B</li>
<li><strong>Main effect of Factor B</strong>: The average effect of Factor B across all levels of Factor A</li>
<li><strong>Interaction effect (A × B)</strong>: The extent to which the effect of one factor depends on the level of the other factor</li>
<li><strong>Residual (error)</strong>: Unexplained variation within treatment groups</li>
</ol>
<p>The statistical model is:</p>
<p><span class="math display">\[y_{ijk} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \epsilon_{ijk}\]</span></p>
<p>where: - <span class="math inline">\(\mu\)</span> is the grand mean - <span class="math inline">\(\alpha_i\)</span> is the effect of level <span class="math inline">\(i\)</span> of Factor A - <span class="math inline">\(\beta_j\)</span> is the effect of level <span class="math inline">\(j\)</span> of Factor B - <span class="math inline">\((\alpha\beta)_{ij}\)</span> is the interaction effect - <span class="math inline">\(\epsilon_{ijk}\)</span> is the random error for observation <span class="math inline">\(k\)</span> in treatment combination <span class="math inline">\(ij\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated factorial experiment: Temperature × Nutrient effects on growth</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">15</span>  <span class="co"># replicates per treatment</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create factorial design data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>temperature <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>), <span class="at">each =</span> <span class="dv">2</span><span class="sc">*</span>n)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>nutrient <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>), <span class="at">each =</span> n), <span class="dv">2</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate growth with main effects AND interaction</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Low temp &amp; low nutrient: baseline 10</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># High nutrient adds 5</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># High temp adds 3</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># BUT interaction: high temp × high nutrient gives extra boost of 4</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">4</span><span class="sc">*</span>n)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"Low"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">10</span>, <span class="fl">1.5</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"High"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">15</span>, <span class="fl">1.5</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"Low"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">13</span>, <span class="fl">1.5</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"High"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">22</span>, <span class="fl">1.5</span>)  <span class="co"># Synergistic effect</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>factorial_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature =</span> <span class="fu">factor</span>(temperature, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>)),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">nutrient =</span> <span class="fu">factor</span>(nutrient, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>)),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">growth =</span> growth</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the design</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(factorial_data, <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> growth, <span class="at">fill =</span> nutrient)) <span class="sc">+</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Factorial Design: Temperature × Nutrient"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Each combination of factor levels is tested"</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Growth Rate"</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Nutrient</span><span class="sc">\n</span><span class="st">Level"</span>) <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>)) <span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-factorial-design" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-factorial-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-factorial-design-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-factorial-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.1: Two-way ANOVA factorial design showing main effects and interaction
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the two-way ANOVA model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>factorial_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(growth <span class="sc">~</span> temperature <span class="sc">*</span> nutrient, <span class="at">data =</span> factorial_data)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(factorial_aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     Df Sum Sq Mean Sq F value   Pr(&gt;F)    
temperature           1  427.4   427.4  228.63  &lt; 2e-16 ***
nutrient              1  638.7   638.7  341.63  &lt; 2e-16 ***
temperature:nutrient  1   67.7    67.7   36.19 1.43e-07 ***
Residuals            56  104.7     1.9                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The ANOVA table shows three F-tests: - <strong>temperature</strong>: Tests whether the main effect of temperature is significant - <strong>nutrient</strong>: Tests whether the main effect of nutrient is significant - <strong>temperature:nutrient</strong>: Tests whether the interaction is significant</p>
</section>
<section id="understanding-interactions" class="level2" data-number="27.3">
<h2 data-number="27.3" class="anchored" data-anchor-id="understanding-interactions"><span class="header-section-number">27.3</span> Understanding Interactions</h2>
<p>An <strong>interaction</strong> occurs when the effect of one factor depends on the level of another factor. Interactions are one of the most important features of factorial designs—they reveal that factors do not operate independently.</p>
<p><strong>Types of effects:</strong></p>
<ol type="1">
<li><p><strong>Additive effects (no interaction)</strong>: The effect of Factor A is the same regardless of Factor B’s level. Effects simply add together.</p></li>
<li><p><strong>Synergistic interaction</strong>: The combined effect is greater than the sum of individual effects. For example, two drugs together might be more effective than expected from their individual effects.</p></li>
<li><p><strong>Antagonistic interaction</strong>: The combined effect is less than expected. One factor might diminish or reverse the effect of another.</p></li>
</ol>
<section id="interaction-plots" class="level3">
<h3 class="anchored" data-anchor-id="interaction-plots">Interaction Plots</h3>
<p>The clearest way to understand interactions is through <strong>interaction plots</strong>, which show the mean response at each factor combination.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means for each combination</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>means_data <span class="ot">&lt;-</span> factorial_data <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature, nutrient) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_growth =</span> <span class="fu">mean</span>(growth),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">se =</span> <span class="fu">sd</span>(growth) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">n</span>()),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interaction plot</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(means_data, <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> mean_growth,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> nutrient, <span class="at">group =</span> nutrient)) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_growth <span class="sc">-</span> se, <span class="at">ymax =</span> mean_growth <span class="sc">+</span> se),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction Plot: Temperature × Nutrient"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Non-parallel lines indicate an interaction effect"</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean Growth Rate"</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Nutrient</span><span class="sc">\n</span><span class="st">Level"</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>)) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative: base R interaction.plot</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.factor =</span> factorial_data<span class="sc">$</span>temperature,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.factor =</span> factorial_data<span class="sc">$</span>nutrient,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> factorial_data<span class="sc">$</span>growth,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>),</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Mean Growth Rate"</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.label =</span> <span class="st">"Nutrient"</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-interaction-plot-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interaction-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-interaction-plot-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interaction-plot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.2: Interaction plot showing non-parallel lines indicating interaction between factors
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-interaction-plot-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interaction-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-interaction-plot-2.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interaction-plot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.3: Interaction plot showing non-parallel lines indicating interaction between factors
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Interpreting interaction plots:</strong></p>
<ul>
<li><strong>Parallel lines</strong> suggest no interaction—the effect of one factor is constant across levels of the other</li>
<li><strong>Non-parallel lines</strong> suggest an interaction—the effect of one factor changes depending on the other factor</li>
<li><strong>Crossing lines</strong> indicate a strong interaction, potentially with a reversal of effects</li>
</ul>
<div id="fig-interaction-patterns" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-interaction-patterns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/ch26/ch26_interaction_patterns.jpeg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-interaction-patterns-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.4: Illustration of interaction patterns showing parallel versus non-parallel lines
</figcaption>
</figure>
</div>
<p>The figure above illustrates common interaction patterns. In panel (a), parallel lines indicate no interaction—the effect of Factor A is the same at both levels of Factor B. In panel (b), non-parallel lines reveal an interaction—the effect of Factor A differs depending on Factor B’s level.</p>
</section>
</section>
<section id="interpreting-main-effects-vs-interactions" class="level2" data-number="27.4">
<h2 data-number="27.4" class="anchored" data-anchor-id="interpreting-main-effects-vs-interactions"><span class="header-section-number">27.4</span> Interpreting Main Effects vs Interactions</h2>
<p>When a significant interaction exists, interpreting main effects requires caution. The main effect represents an average across levels of the other factor, but if there’s an interaction, this average may not meaningfully represent what happens at any particular level.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
When Interactions are Present
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the interaction is significant, focus on <strong>simple effects</strong>—the effect of one factor at each level of the other factor—rather than main effects. The main effect is an average that may obscure important differences.</p>
</div>
</div>
<p><strong>Simple effects analysis</strong> examines the effect of one factor separately at each level of the other factor:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple effects: effect of nutrient at each temperature level</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Low temperature</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>low_temp_data <span class="ot">&lt;-</span> factorial_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(temperature <span class="sc">==</span> <span class="st">"Low"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(growth <span class="sc">~</span> nutrient, <span class="at">data =</span> low_temp_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  growth by nutrient
t = -8.2269, df = 26.34, p-value = 9.446e-09
alternative hypothesis: true difference in means between group Low and group High is not equal to 0
95 percent confidence interval:
 -5.500596 -3.302476
sample estimates:
 mean in group Low mean in group High 
          10.22858           14.63011 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># High temperature</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>high_temp_data <span class="ot">&lt;-</span> factorial_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(temperature <span class="sc">==</span> <span class="st">"High"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(growth <span class="sc">~</span> nutrient, <span class="at">data =</span> high_temp_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  growth by nutrient
t = -18.771, df = 27.893, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means between group Low and group High is not equal to 0
95 percent confidence interval:
 -9.593152 -7.705141
sample estimates:
 mean in group Low mean in group High 
          13.44293           22.09208 </code></pre>
</div>
</div>
<p>In our example, the nutrient effect is significant at both temperatures, but the magnitude differs—the interaction shows that the nutrient boost is stronger at high temperature.</p>
</section>
<section id="ancova-analysis-of-covariance" class="level2" data-number="27.5">
<h2 data-number="27.5" class="anchored" data-anchor-id="ancova-analysis-of-covariance"><span class="header-section-number">27.5</span> ANCOVA: Analysis of Covariance</h2>
<p><strong>Analysis of Covariance (ANCOVA)</strong> combines ANOVA with regression by including both categorical factors and continuous covariates. The covariate is a continuous variable that you want to control for—it’s not a treatment you manipulate, but a source of variation you want to account for.</p>
<p><strong>Common uses of ANCOVA:</strong> - Controlling for pre-existing differences (baseline measurements) - Increasing precision by removing variance explained by the covariate - Adjusting for confounding variables - Testing whether regression slopes differ across groups</p>
<section id="the-ancova-model" class="level3">
<h3 class="anchored" data-anchor-id="the-ancova-model">The ANCOVA Model</h3>
<p>The ANCOVA model for one factor and one covariate is:</p>
<p><span class="math display">\[y_{ij} = \mu + \alpha_i + \beta(x_{ij} - \bar{x}) + \epsilon_{ij}\]</span></p>
<p>where: - <span class="math inline">\(\mu\)</span> is the overall mean - <span class="math inline">\(\alpha_i\)</span> is the effect of group <span class="math inline">\(i\)</span> - <span class="math inline">\(\beta\)</span> is the regression slope (common to all groups) - <span class="math inline">\(x_{ij}\)</span> is the covariate value - <span class="math inline">\(\bar{x}\)</span> is the mean of the covariate - <span class="math inline">\(\epsilon_{ij}\)</span> is the random error</p>
<p>The key assumption is that the relationship between the covariate and response has the <strong>same slope in all groups</strong> (homogeneity of regression slopes).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated ANCOVA example: Effect of diet on final weight, controlling for initial weight</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">567</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>n_per_group <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Three diet treatments</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>diet_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">diet =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Low-fat"</span>, <span class="st">"High-protein"</span>), <span class="at">each =</span> n_per_group)),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial_weight =</span> <span class="fu">c</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(n_per_group, <span class="dv">75</span>, <span class="dv">8</span>),   <span class="co"># Control group</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(n_per_group, <span class="dv">78</span>, <span class="dv">8</span>),   <span class="co"># Low-fat (slightly heavier initially)</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(n_per_group, <span class="dv">73</span>, <span class="dv">8</span>)    <span class="co"># High-protein (slightly lighter initially)</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final weight depends on diet AND initial weight</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Diet effects: Control = 0, Low-fat = -3, High-protein = -5</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">diet_effect =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      diet <span class="sc">==</span> <span class="st">"Control"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      diet <span class="sc">==</span> <span class="st">"Low-fat"</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      diet <span class="sc">==</span> <span class="st">"High-protein"</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final weight = initial + diet effect + some regression to mean + noise</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_weight =</span> initial_weight <span class="sc">+</span> diet_effect <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> (initial_weight <span class="sc">-</span> <span class="dv">75</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the ANCOVA setup</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diet_data, <span class="fu">aes</span>(<span class="at">x =</span> initial_weight, <span class="at">y =</span> final_weight, <span class="at">color =</span> diet)) <span class="sc">+</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ANCOVA: Diet Effect on Final Weight"</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Parallel regression lines show diet effects while controlling for initial weight"</span>,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Initial Weight (kg)"</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Final Weight (kg)"</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Control"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Low-fat"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"High-protein"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>)) <span class="sc">+</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ancova-example" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ancova-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-ancova-example-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ancova-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.5: ANCOVA example showing treatment effects on final weight while controlling for initial weight
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="fitting-ancova-in-r" class="level3">
<h3 class="anchored" data-anchor-id="fitting-ancova-in-r">Fitting ANCOVA in R</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ancova_model <span class="ot">&lt;-</span> <span class="fu">aov</span>(final_weight <span class="sc">~</span> initial_weight <span class="sc">+</span> diet, <span class="at">data =</span> diet_data)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ancova_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               Df Sum Sq Mean Sq F value   Pr(&gt;F)    
initial_weight  1   7582    7582  607.91  &lt; 2e-16 ***
diet            2    270     135   10.83 0.000106 ***
Residuals      56    698      12                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Note the order of terms: the covariate (<code>initial_weight</code>) is entered first to remove its effect before testing the factor (<code>diet</code>).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to ANOVA without covariate</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>anova_only <span class="ot">&lt;-</span> <span class="fu">aov</span>(final_weight <span class="sc">~</span> diet, <span class="at">data =</span> diet_data)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_only)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
diet         2   1951   975.5   8.426 0.000623 ***
Residuals   57   6600   115.8                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The ANCOVA has smaller residual SS and more power</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Residual SS (ANOVA):"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">residuals</span>(anova_only)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Residual SS (ANOVA): 6599.6 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Residual SS (ANCOVA):"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">residuals</span>(ancova_model)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Residual SS (ANCOVA): 698.5 </code></pre>
</div>
</div>
</section>
<section id="adjusted-means" class="level3">
<h3 class="anchored" data-anchor-id="adjusted-means">Adjusted Means</h3>
<p>ANCOVA produces <strong>adjusted means</strong>—the group means estimated at the overall mean of the covariate. These are the means we would expect if all groups had started with the same covariate value.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get adjusted means</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ancova_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(ancova_model, <span class="st">"diet"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>ancova_emm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> diet         emmean    SE df lower.CL upper.CL
 Control        73.7 0.802 56     72.1     75.3
 High-protein   68.6 0.818 56     66.9     70.2
 Low-fat        70.3 0.864 56     68.6     72.0

Confidence level used: 0.95 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons of adjusted means</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(ancova_emm, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                   estimate   SE df t.ratio p.value
 Control - (High-protein)       5.11 1.12 56   4.567 &lt;0.0001
 Control - (Low-fat)            3.38 1.22 56   2.774  0.0202
 (High-protein) - (Low-fat)    -1.73 1.25 56  -1.385  0.3554

P value adjustment: tukey method for comparing a family of 3 estimates </code></pre>
</div>
</div>
</section>
<section id="testing-homogeneity-of-slopes" class="level3">
<h3 class="anchored" data-anchor-id="testing-homogeneity-of-slopes">Testing Homogeneity of Slopes</h3>
<p>A critical assumption is that regression slopes are equal across groups. Test this by including the interaction term:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for unequal slopes (interaction between covariate and factor)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>slope_test <span class="ot">&lt;-</span> <span class="fu">aov</span>(final_weight <span class="sc">~</span> initial_weight <span class="sc">*</span> diet, <span class="at">data =</span> diet_data)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(slope_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    Df Sum Sq Mean Sq F value   Pr(&gt;F)    
initial_weight       1   7582    7582  594.01  &lt; 2e-16 ***
diet                 2    270     135   10.58 0.000133 ***
initial_weight:diet  2      9       5    0.36 0.699390    
Residuals           54    689      13                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>A significant interaction indicates slopes differ across groups, violating the ANCOVA assumption. In that case, you should: 1. Report separate regressions for each group 2. Use a more complex model (separate slopes ANCOVA) 3. Consider whether the interaction itself is scientifically meaningful</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize slopes by group</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diet_data, <span class="fu">aes</span>(<span class="at">x =</span> initial_weight, <span class="at">y =</span> final_weight, <span class="at">color =</span> diet)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Testing Homogeneity of Regression Slopes"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Slopes should be approximately parallel for valid ANCOVA"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Initial Weight (kg)"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Final Weight (kg)"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Control"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Low-fat"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"High-protein"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>)) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ancova-slopes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ancova-slopes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-ancova-slopes-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ancova-slopes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.6: Testing homogeneity of slopes: parallel lines indicate the assumption is met
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ANCOVA Assumptions
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>Independence</strong> of observations</li>
<li><strong>Normality</strong> of residuals</li>
<li><strong>Homogeneity of variance</strong> across groups</li>
<li><strong>Linear relationship</strong> between covariate and response</li>
<li><strong>Homogeneity of regression slopes</strong> (equal slopes across groups)</li>
<li><strong>Covariate measured without error</strong> (or with negligible error)</li>
<li><strong>Covariate independent of treatment</strong> (especially important in observational studies)</li>
</ol>
<p>The last assumption is critical: if the treatment affects the covariate, ANCOVA can remove real treatment effects. The covariate should ideally be measured before treatment is applied.</p>
</div>
</div>
</section>
<section id="when-to-use-ancova" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-ancova">When to Use ANCOVA</h3>
<p><strong>Use ANCOVA when:</strong> - You have a continuous covariate measured before treatment - You want to increase precision by accounting for baseline variation - Groups differ on the covariate (but not due to treatment) - The covariate-response relationship is linear with equal slopes</p>
<p><strong>Avoid ANCOVA when:</strong> - The covariate is affected by treatment - Slopes clearly differ across groups - The covariate is categorical (use factorial ANOVA instead) - Sample sizes are very small</p>
</section>
</section>
<section id="nested-designs" class="level2" data-number="27.6">
<h2 data-number="27.6" class="anchored" data-anchor-id="nested-designs"><span class="header-section-number">27.6</span> Nested Designs</h2>
<p>In <strong>nested designs</strong>, levels of one factor exist only within levels of another factor. This differs from a factorial design where all combinations of factors are crossed.</p>
<p><strong>Common examples in biology:</strong> - Students nested within classrooms (each student is in only one classroom) - Samples nested within sites (each sample comes from one site) - Technicians nested within labs (each technician works in one lab) - Subsamples nested within experimental units</p>
<p>In a nested design, we cannot estimate an interaction because not all factor combinations exist. The nested factor is typically a random effect representing sampling variability.</p>
<p><strong>Notation:</strong> Factor B is nested within Factor A, written as B(A) or B/A.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated nested design: Technicians (nested within Labs)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>n_labs <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>n_techs_per_lab <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>n_measurements <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>lab <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"Lab"</span>, <span class="dv">1</span><span class="sc">:</span>n_labs), <span class="at">each =</span> n_techs_per_lab <span class="sc">*</span> n_measurements)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>tech <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"Tech"</span>, <span class="dv">1</span><span class="sc">:</span>(n_labs <span class="sc">*</span> n_techs_per_lab)), <span class="at">each =</span> n_measurements)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Lab effects (fixed)</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>lab_effects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">105</span>, <span class="dv">110</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Technician effects (random, nested within labs)</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>tech_effects <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_labs <span class="sc">*</span> n_techs_per_lab, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>measurement <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(lab))</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lab)) {</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  lab_idx <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(lab[i], <span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  tech_idx <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(tech[i], <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  measurement[i] <span class="ot">&lt;-</span> lab_effects[lab_idx] <span class="sc">+</span> tech_effects[tech_idx] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>nested_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab =</span> <span class="fu">factor</span>(lab),</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">tech =</span> <span class="fu">factor</span>(tech),</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">measurement =</span> measurement</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize nested structure</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nested_data, <span class="fu">aes</span>(<span class="at">x =</span> tech, <span class="at">y =</span> measurement, <span class="at">color =</span> lab)) <span class="sc">+</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nested Design: Technicians within Labs"</span>,</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Each technician works in only one lab"</span>,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Technician"</span>,</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Measurement"</span>) <span class="sc">+</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-nested-design" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nested-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-nested-design-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nested-design-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.7: Nested design example: technicians nested within labs
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis of nested design</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Technician is nested within lab: tech %in% lab or tech/lab</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>nested_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(measurement <span class="sc">~</span> lab <span class="sc">+</span> <span class="fu">Error</span>(tech <span class="sc">%in%</span> lab), <span class="at">data =</span> nested_data)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nested_aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Error: tech:lab
          Df Sum Sq Mean Sq F value  Pr(&gt;F)   
lab        2 1157.6   578.8   24.02 0.00137 **
Residuals  6  144.6    24.1                   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Error: Within
          Df Sum Sq Mean Sq F value Pr(&gt;F)
Residuals 36  150.8   4.189               </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative using lme4 for mixed effects</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>nested_lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(measurement <span class="sc">~</span> lab <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>lab<span class="sc">:</span>tech), <span class="at">data =</span> nested_data)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nested_lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: measurement ~ lab + (1 | lab:tech)
   Data: nested_data

REML criterion at convergence: 198

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.12446 -0.44723 -0.04123  0.60879  1.92716 

Random effects:
 Groups   Name        Variance Std.Dev.
 lab:tech (Intercept) 3.982    1.996   
 Residual             4.189    2.047   
Number of obs: 45, groups:  lab:tech, 9

Fixed effects:
            Estimate Std. Error t value
(Intercept)  100.966      1.268  79.653
labLab2        1.425      1.793   0.795
labLab3       11.401      1.793   6.360

Correlation of Fixed Effects:
        (Intr) labLb2
labLab2 -0.707       
labLab3 -0.707  0.500</code></pre>
</div>
</div>
<p>The nested design partitions variance into: - <strong>Between labs</strong> (fixed effect) - <strong>Between technicians within labs</strong> (random effect) - <strong>Within technicians</strong> (residual error)</p>
</section>
<section id="repeated-measures-anova" class="level2" data-number="27.7">
<h2 data-number="27.7" class="anchored" data-anchor-id="repeated-measures-anova"><span class="header-section-number">27.7</span> Repeated Measures ANOVA</h2>
<p>When the same subjects are measured multiple times under different conditions, observations are not independent. <strong>Repeated measures ANOVA</strong> accounts for the correlation structure in the data by treating subjects as a blocking factor or random effect.</p>
<p><strong>Advantages:</strong> - Increased statistical power (controls for individual differences) - Requires fewer subjects - Each subject serves as their own control</p>
<p><strong>Assumptions:</strong> - <strong>Sphericity</strong>: The variance of differences between all pairs of repeated measures should be equal - Violations of sphericity can be corrected using Greenhouse-Geisser or Huynh-Feldt adjustments</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated repeated measures: Drug effect over time</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>n_subjects <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>timepoints <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="st">"Week_1"</span>, <span class="st">"Week_2"</span>, <span class="st">"Week_4"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Each subject has a baseline level</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>baseline_values <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_subjects, <span class="dv">50</span>, <span class="dv">10</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment effect increases over time</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>time_effects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">6</span>, <span class="sc">-</span><span class="dv">8</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>rm_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>n_subjects),</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">factor</span>(timepoints, <span class="at">levels =</span> timepoints)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subject, time) <span class="sc">%&gt;%</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseline =</span> <span class="fu">rep</span>(baseline_values, <span class="at">each =</span> <span class="fu">length</span>(timepoints)),</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_num =</span> <span class="fu">as.numeric</span>(time),</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> baseline <span class="sc">+</span> time_effects[time_num] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize repeated measures</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rm_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> response, <span class="at">group =</span> subject)) <span class="sc">+</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Repeated Measures: Drug Response Over Time"</span>,</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Gray lines show individual subjects; red line shows mean response"</span>,</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Response Variable"</span>) <span class="sc">+</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-repeated-measures" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-repeated-measures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-repeated-measures-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-repeated-measures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.8: Repeated measures design showing within-subject changes over time
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Traditional repeated measures ANOVA</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Error term specifies within-subject factor</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>rm_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(response <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">Error</span>(subject<span class="sc">/</span>time), <span class="at">data =</span> rm_data)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rm_aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Error: subject
          Df Sum Sq Mean Sq F value Pr(&gt;F)
Residuals 11   2802   254.7               

Error: subject:time
          Df Sum Sq Mean Sq F value   Pr(&gt;F)    
time       3  525.4  175.13   45.13 8.86e-12 ***
Residuals 33  128.0    3.88                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check sphericity assumption</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to wide format for Mauchly's test</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>rm_wide <span class="ot">&lt;-</span> rm_data <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject, time, response) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time, <span class="at">values_from =</span> response)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative: Use mixed effects model (handles violations better)</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>rm_lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(response <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>subject), <span class="at">data =</span> rm_data)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rm_lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: response ~ time + (1 | subject)
   Data: rm_data

REML criterion at convergence: 240.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.7487 -0.5256  0.1230  0.6037  1.3658 

Random effects:
 Groups   Name        Variance Std.Dev.
 subject  (Intercept) 62.71    7.919   
 Residual              3.88    1.970   
Number of obs: 48, groups:  subject, 12

Fixed effects:
            Estimate Std. Error t value
(Intercept)  46.1978     2.3557  19.611
timeWeek_1   -3.0335     0.8042  -3.772
timeWeek_2   -6.7738     0.8042  -8.423
timeWeek_4   -8.5300     0.8042 -10.607

Correlation of Fixed Effects:
           (Intr) tmWk_1 tmWk_2
timeWeek_1 -0.171              
timeWeek_2 -0.171  0.500       
timeWeek_4 -0.171  0.500  0.500</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(rm_lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table
     npar Sum Sq Mean Sq F value
time    3  525.4  175.13  45.134</code></pre>
</div>
</div>
<p><strong>Post-hoc tests for repeated measures:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons with correction for multiple testing</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>rm_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(rm_lmer, <span class="st">"time"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(rm_emm, <span class="at">adjust =</span> <span class="st">"bonferroni"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> contrast          estimate    SE df t.ratio p.value
 Baseline - Week_1     3.03 0.804 33   3.772  0.0038
 Baseline - Week_2     6.77 0.804 33   8.423 &lt;0.0001
 Baseline - Week_4     8.53 0.804 33  10.607 &lt;0.0001
 Week_1 - Week_2       3.74 0.804 33   4.651  0.0003
 Week_1 - Week_4       5.50 0.804 33   6.835 &lt;0.0001
 Week_2 - Week_4       1.76 0.804 33   2.184  0.2171

Degrees-of-freedom method: kenward-roger 
P value adjustment: bonferroni method for 6 tests </code></pre>
</div>
</div>
</section>
<section id="mixed-effects-models" class="level2" data-number="27.8">
<h2 data-number="27.8" class="anchored" data-anchor-id="mixed-effects-models"><span class="header-section-number">27.8</span> Mixed Effects Models</h2>
<p><strong>Mixed effects models</strong> (also called <strong>multilevel models</strong> or <strong>hierarchical models</strong>) include both <strong>fixed effects</strong> (factors of primary interest) and <strong>random effects</strong> (sources of random variation).</p>
<p><strong>When to use mixed effects models:</strong> - Repeated measures or longitudinal data - Nested or hierarchical data structures - Multiple sources of random variation - Unbalanced designs or missing data - Continuous covariates combined with grouping factors</p>
<p><strong>Fixed vs Random Effects:</strong></p>
<ul>
<li><strong>Fixed effects</strong>: Specific levels you chose (e.g., specific drug treatments, particular temperatures)</li>
<li><strong>Random effects</strong>: Levels sampled from a larger population (e.g., subjects, batches, field sites)</li>
</ul>
<p>The <code>lme4</code> package in R provides powerful tools for mixed effects models:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Growth curve with random intercepts and slopes</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>n_individuals <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>n_timepoints <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">individual =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>n_individuals),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">0</span><span class="sc">:</span>(n_timepoints<span class="dv">-1</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random intercept for each individual</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_individuals, <span class="dv">5</span>, <span class="dv">1</span>), <span class="at">each =</span> n_timepoints),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random slope for each individual</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_individuals, <span class="fl">0.8</span>, <span class="fl">0.15</span>), <span class="at">each =</span> n_timepoints),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate size with individual variation</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> intercept <span class="sc">+</span> slope <span class="sc">*</span> time <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit mixed effects model with random intercepts and slopes</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>mixed_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(size <span class="sc">~</span> time <span class="sc">+</span> (time<span class="sc">|</span>individual), <span class="at">data =</span> growth_data)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mixed_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: size ~ time + (time | individual)
   Data: growth_data

REML criterion at convergence: 233.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-1.8644 -0.6987 -0.1743  0.6597  2.0678 

Random effects:
 Groups     Name        Variance Std.Dev. Corr 
 individual (Intercept) 0.10232  0.3199        
            time        0.01272  0.1128   -0.13
 Residual               0.61532  0.7844        
Number of obs: 90, groups:  individual, 15

Fixed effects:
            Estimate Std. Error t value
(Intercept)   5.2214     0.1683   31.03
time          0.7760     0.0565   13.73

Correlation of Fixed Effects:
     (Intr)
time -0.650</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to model with only random intercepts</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>mixed_model_int <span class="ot">&lt;-</span> <span class="fu">lmer</span>(size <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>individual), <span class="at">data =</span> growth_data)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood ratio test</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mixed_model_int, mixed_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data: growth_data
Models:
mixed_model_int: size ~ time + (1 | individual)
mixed_model: size ~ time + (time | individual)
                npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)
mixed_model_int    4 236.62 246.62 -114.31    228.62                     
mixed_model        6 239.35 254.35 -113.68    227.35 1.2682  2     0.5304</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize random effects</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(growth_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> size, <span class="at">group =</span> individual)) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(mixed_model)[<span class="dv">1</span>],</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="fu">fixef</span>(mixed_model)[<span class="dv">2</span>],</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mixed Effects Model: Growth Curves"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Gray lines show individuals; red line shows population average (fixed effect)"</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Size"</span>) <span class="sc">+</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-mixed-effects" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mixed-effects-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-mixed-effects-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mixed-effects-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.9: Mixed effects model showing fixed effect (population trend) and random effects (individual variation)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="split-plot-designs" class="level2" data-number="27.9">
<h2 data-number="27.9" class="anchored" data-anchor-id="split-plot-designs"><span class="header-section-number">27.9</span> Split-Plot Designs</h2>
<p><strong>Split-plot designs</strong> arise when different factors are applied at different scales or when complete randomization is impractical. Originally developed for agricultural field trials, they’re common in biological experiments.</p>
<p><strong>Structure:</strong> - <strong>Whole plots</strong>: Larger experimental units receiving one factor (hard-to-change factor) - <strong>Split plots</strong> (or <strong>subplots</strong>): Smaller units within whole plots receiving another factor (easy-to-change factor)</p>
<p><strong>Example:</strong> Testing the effect of irrigation (whole plot factor) and fertilizer (split-plot factor) on crop yield. Irrigation is applied to large field plots, while different fertilizers can be applied to smaller areas within each irrigation plot.</p>
<p><strong>In laboratory settings:</strong> - Whole plot: Temperature chambers (hard to randomize, limited number) - Split plot: Different nutrient treatments within each chamber (easy to randomize)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated split-plot design</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Whole plot: Temperature (2 levels, 4 replicates each = 8 chambers)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split plot: Nutrient (3 levels per chamber)</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">654</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>n_chambers_per_temp <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>n_nutrients <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>n_reps <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># technical replicates within each split plot</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>split_plot_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">temp =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>), <span class="at">each =</span> n_chambers_per_temp)),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chamber =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">2</span> <span class="sc">*</span> n_chambers_per_temp)),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">nutrient =</span> <span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="st">"N"</span>, <span class="dv">1</span><span class="sc">:</span>n_nutrients)),</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span>n_reps</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_effect =</span> <span class="fu">ifelse</span>(temp <span class="sc">==</span> <span class="st">"Low"</span>, <span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Chambers vary even at same temperature (whole plot error)</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">chamber_effect =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="dv">2</span> <span class="sc">*</span> n_chambers_per_temp, <span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">each =</span> n_nutrients <span class="sc">*</span> n_reps),</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">nutrient_effect =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>), <span class="at">times =</span> <span class="dv">2</span> <span class="sc">*</span> n_chambers_per_temp <span class="sc">*</span> n_reps),</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interaction between temp and nutrient</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">interaction =</span> <span class="fu">ifelse</span>(temp <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"N3"</span>, <span class="dv">3</span>, <span class="dv">0</span>),</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">yield =</span> <span class="dv">10</span> <span class="sc">+</span> temp_effect <span class="sc">+</span> chamber_effect <span class="sc">+</span> nutrient_effect <span class="sc">+</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>            interaction <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in `mutate()`:
ℹ In argument: `chamber_effect = rep(...)`.
Caused by error:
! `chamber_effect` must be size 384 or 1, not 48.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize split-plot structure</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(split_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> nutrient, <span class="at">y =</span> yield, <span class="at">color =</span> temp)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="fl">0.2</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_se, <span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">width =</span> <span class="fl">0.2</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> temp) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Split-Plot Design: Temperature (whole plot) × Nutrient (split plot)"</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Temperature applied to whole chambers; nutrients varied within chambers"</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Nutrient Level (Split-Plot Factor)"</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Yield"</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Temperature</span><span class="sc">\n</span><span class="st">(Whole-Plot)"</span>) <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error:
! object 'split_plot_data' not found</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis of split-plot design</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Whole plot factor: temperature (tested against chamber error)</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split plot factor: nutrient (tested against split-plot error)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use mixed model with chamber as random effect</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>split_plot_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(yield <span class="sc">~</span> temp <span class="sc">*</span> nutrient <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>chamber),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> split_plot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error:
! bad 'data': object 'split_plot_data' not found</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(split_plot_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in `h()`:
! error in evaluating the argument 'object' in selecting a method for function 'summary': object 'split_plot_model' not found</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(split_plot_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error:
! object 'split_plot_model' not found</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: The whole-plot factor (temp) has fewer degrees of freedom</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># because it varies only among chambers, not within them</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Key features of split-plot analysis:</strong> - Different error terms for whole-plot and split-plot factors - Whole-plot tests have fewer degrees of freedom (less powerful) - Split-plot tests are more powerful (more replication) - Interactions use split-plot error term</p>
</section>
<section id="practical-considerations-for-complex-designs" class="level2" data-number="27.10">
<h2 data-number="27.10" class="anchored" data-anchor-id="practical-considerations-for-complex-designs"><span class="header-section-number">27.10</span> Practical Considerations for Complex Designs</h2>
<section id="sample-size-and-power" class="level3">
<h3 class="anchored" data-anchor-id="sample-size-and-power">Sample Size and Power</h3>
<p>Complex designs require careful power analysis. The power for detecting: - <strong>Main effects</strong> depends on the number of replicates and effect size - <strong>Interactions</strong> is typically lower than for main effects—interactions require larger samples</p>
<p>Use simulation-based power analysis for complex designs where analytical solutions are difficult.</p>
</section>
<section id="balanced-vs-unbalanced-designs" class="level3">
<h3 class="anchored" data-anchor-id="balanced-vs-unbalanced-designs">Balanced vs Unbalanced Designs</h3>
<p><strong>Balanced designs</strong> (equal sample sizes in all cells) are preferable: - Simpler interpretation - Greater statistical power - Robust to assumption violations - Easier to test for interactions</p>
<p><strong>Unbalanced designs</strong> complicate analysis: - Type I, II, and III sums of squares give different results - Main effects and interactions are correlated - Reduced power for some effects</p>
<p>When unavoidable, use Type III sums of squares with caution and consider mixed effects models.</p>
</section>
<section id="effect-sizes-in-multi-factor-anova" class="level3">
<h3 class="anchored" data-anchor-id="effect-sizes-in-multi-factor-anova">Effect Sizes in Multi-Factor ANOVA</h3>
<p>Report effect sizes for all significant effects:</p>
<p><strong>Partial eta-squared</strong> (<span class="math inline">\(\eta^2_p\)</span>): Proportion of variance explained by each effect, removing variance from other effects:</p>
<p><span class="math display">\[\eta^2_p = \frac{SS_{effect}}{SS_{effect} + SS_{error}}\]</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate effect sizes from factorial ANOVA</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effectsize)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">eta_squared</span>(factorial_aov, <span class="at">partial =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Effect Size for ANOVA (Type I)

Parameter            | Eta2 (partial) |       95% CI
----------------------------------------------------
temperature          |           0.80 | [0.73, 1.00]
nutrient             |           0.86 | [0.80, 1.00]
temperature:nutrient |           0.39 | [0.23, 1.00]

- One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
</div>
</section>
<section id="multiple-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="multiple-comparisons">Multiple Comparisons</h3>
<p>With many factor levels and combinations, multiple comparison corrections become crucial:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc comparisons for factorial design</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>factorial_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(factorial_aov, <span class="sc">~</span> temperature <span class="sc">*</span> nutrient)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># All pairwise comparisons</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(factorial_emm, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> contrast             estimate    SE df t.ratio p.value
 Low Low - High Low      -3.21 0.499 56  -6.438 &lt;0.0001
 Low Low - Low High      -4.40 0.499 56  -8.816 &lt;0.0001
 Low Low - High High    -11.86 0.499 56 -23.761 &lt;0.0001
 High Low - Low High     -1.19 0.499 56  -2.378  0.0932
 High Low - High High    -8.65 0.499 56 -17.323 &lt;0.0001
 Low High - High High    -7.46 0.499 56 -14.946 &lt;0.0001

P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple effects: nutrient effect at each temperature</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>nutrient_simple <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(factorial_aov, <span class="sc">~</span> nutrient <span class="sc">|</span> temperature)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(nutrient_simple, <span class="at">adjust =</span> <span class="st">"bonferroni"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>temperature = Low:
 contrast   estimate    SE df t.ratio p.value
 Low - High    -4.40 0.499 56  -8.816 &lt;0.0001

temperature = High:
 contrast   estimate    SE df t.ratio p.value
 Low - High    -8.65 0.499 56 -17.323 &lt;0.0001</code></pre>
</div>
</div>
</section>
<section id="model-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="model-assumptions">Model Assumptions</h3>
<p>Check assumptions for all error terms in complex designs:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plots</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(factorial_aov)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Test homogeneity of variance</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(growth <span class="sc">~</span> temperature <span class="sc">*</span> nutrient, <span class="at">data =</span> factorial_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value Pr(&gt;F)
group  3  0.8227 0.4869
      56               </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test normality of residuals</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(factorial_aov))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(factorial_aov)
W = 0.98365, p-value = 0.6001</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-diagnostic-plots" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diagnostic-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="26-multifactor-anova_files/figure-html/fig-diagnostic-plots-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diagnostic-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;27.10: Diagnostic plots for checking ANOVA assumptions
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="reporting-results" class="level3">
<h3 class="anchored" data-anchor-id="reporting-results">Reporting Results</h3>
<p>When reporting multi-factor ANOVA results, include:</p>
<ol type="1">
<li><strong>Descriptive statistics</strong> for each cell (means, SDs, sample sizes)</li>
<li><strong>ANOVA table</strong> with F-values, degrees of freedom, and p-values for all effects</li>
<li><strong>Effect sizes</strong> (partial eta-squared or omega-squared)</li>
<li><strong>Post-hoc tests</strong> or simple effects when interactions are significant</li>
<li><strong>Diagnostic plots</strong> confirming assumptions (in supplementary materials)</li>
<li><strong>Graphical display</strong> of means with error bars (interaction plots for two-way designs)</li>
</ol>
<p>Example reporting:</p>
<blockquote class="blockquote">
<p>We conducted a 2 × 2 factorial ANOVA to examine the effects of temperature (low vs.&nbsp;high) and nutrient level (low vs.&nbsp;high) on algal growth rate. There was a significant main effect of temperature, F(1, 56) = 45.2, p &lt; .001, <span class="math inline">\(\eta^2_p\)</span> = 0.45, and a significant main effect of nutrient level, F(1, 56) = 89.7, p &lt; .001, <span class="math inline">\(\eta^2_p\)</span> = 0.62. Critically, there was a significant temperature × nutrient interaction, F(1, 56) = 12.3, p &lt; .001, <span class="math inline">\(\eta^2_p\)</span> = 0.18. Simple effects analysis revealed that the nutrient effect was significant at both temperatures (both p &lt; .001), but the magnitude was greater at high temperature (Δ = 9.1 units) than at low temperature (Δ = 5.2 units).</p>
</blockquote>
</section>
</section>
<section id="summary" class="level2" data-number="27.11">
<h2 data-number="27.11" class="anchored" data-anchor-id="summary"><span class="header-section-number">27.11</span> Summary</h2>
<p>Multi-factor ANOVA extends the basic ANOVA framework to designs with multiple factors:</p>
<ul>
<li><strong>Factorial designs</strong> test all combinations of factor levels, allowing estimation of main effects and interactions</li>
<li><strong>Interactions</strong> reveal that factors do not operate independently—the effect of one factor depends on another</li>
<li><strong>Interaction plots</strong> with non-parallel lines indicate interactions; interpret simple effects rather than main effects when interactions are significant</li>
<li><strong>ANCOVA</strong> combines categorical factors with continuous covariates, controlling for baseline variation and increasing statistical power</li>
<li><strong>Nested designs</strong> have hierarchical structure where levels of one factor exist only within another; common in hierarchical sampling</li>
<li><strong>Repeated measures ANOVA</strong> accounts for correlation when the same subjects are measured multiple times</li>
<li><strong>Mixed effects models</strong> include both fixed and random effects, providing flexibility for complex data structures</li>
<li><strong>Split-plot designs</strong> arise when factors are applied at different scales or complete randomization is impractical</li>
<li>Always report effect sizes, check assumptions, and use appropriate corrections for multiple comparisons</li>
<li>Balanced designs are preferable but mixed effects models can handle unbalanced data</li>
</ul>
<p>Understanding when and how to use multi-factor ANOVA is essential for designing efficient experiments and extracting maximum information from biological data. The ability to test for interactions is particularly valuable—discovering that factors interact often leads to deeper biological insights than finding main effects alone.</p>
</section>
<section id="practice-exercises" class="level2" data-number="27.12">
<h2 data-number="27.12" class="anchored" data-anchor-id="practice-exercises"><span class="header-section-number">27.12</span> Practice Exercises</h2>
<ol type="1">
<li><p><strong>Design Question</strong>: You want to test the effect of three fertilizer types (A, B, C) and two watering regimes (low, high) on plant growth.</p>
<ul>
<li>How many treatment combinations are in this design?</li>
<li>Draw a diagram showing all treatment groups</li>
<li>Is this a balanced design if you have 10 plants per treatment?</li>
</ul></li>
<li><p><strong>Interaction Interpretation</strong>: An experiment tests the effect of drug (present vs.&nbsp;absent) and exercise (yes vs.&nbsp;no) on weight loss. The means are:</p>
<ul>
<li><p>No drug, no exercise: 2 kg lost</p></li>
<li><p>No drug, exercise: 5 kg lost</p></li>
<li><p>Drug, no exercise: 6 kg lost</p></li>
<li><p>Drug + exercise: 8 kg lost</p></li>
<li><p>Sketch an interaction plot</p></li>
<li><p>Is there an interaction? How do you know?</p></li>
<li><p>Interpret the results in practical terms</p></li>
</ul></li>
<li><p><strong>Data Analysis</strong>: Using the built-in <code>ToothGrowth</code> dataset in R, which examines the effect of Vitamin C dose (0.5, 1.0, 2.0 mg) and delivery method (orange juice vs.&nbsp;ascorbic acid) on tooth length in guinea pigs:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ToothGrowth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Conduct a two-way ANOVA</li>
<li>Create an interaction plot</li>
<li>Is there a significant interaction?</li>
<li>Calculate effect sizes</li>
<li>Write a brief results paragraph</li>
</ul></li>
<li><p><strong>Nested vs.&nbsp;Crossed</strong>: For each scenario, identify whether the design is nested or crossed:</p>
<ul>
<li><ol type="a">
<li>Students within schools, testing two teaching methods across all schools</li>
</ol></li>
<li><ol start="2" type="a">
<li>Patients within clinics, with each clinic using all three drug treatments</li>
</ol></li>
<li><ol start="3" type="a">
<li>Leaves within trees, where trees are sampled from three different forests</li>
</ol></li>
<li><ol start="4" type="a">
<li>Two temperature conditions and three light conditions, all combinations tested</li>
</ol></li>
</ul></li>
<li><p><strong>Repeated Measures</strong>: Design a repeated measures experiment to test whether a new drug reduces anxiety over time.</p>
<ul>
<li>Specify your factors and levels</li>
<li>How many participants would you need for 80% power?</li>
<li>What would your repeated measure be?</li>
<li>What assumptions must you check?</li>
</ul></li>
<li><p><strong>Sample Size</strong>: In a 3 × 2 factorial design:</p>
<ul>
<li>How many treatment combinations exist?</li>
<li>If you want 20 observations per cell, how many total observations do you need?</li>
<li>Which effect (main or interaction) typically requires larger sample sizes to detect?</li>
</ul></li>
<li><p><strong>Mixed Effects Application</strong>: You measure bacterial growth in 20 Petri dishes, with 5 measurements per dish across four timepoints.</p>
<ul>
<li>What is the fixed effect?</li>
<li>What is the random effect?</li>
<li>Write the <code>lmer()</code> model formula</li>
<li>Why is a mixed effects model appropriate here?</li>
</ul></li>
<li><p><strong>Practical Design</strong>: You have access to 4 growth chambers and want to test 3 light conditions and 2 CO₂ levels.</p>
<ul>
<li>Why might a split-plot design be necessary?</li>
<li>Which factor should be the whole-plot factor? Why?</li>
<li>Sketch the design layout</li>
<li>What are the implications for statistical power?</li>
</ul></li>
</ol>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/25-single-factor-anova.html" class="pagination-link" aria-label="Single Factor ANOVA">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Single Factor ANOVA</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/27-glm.html" class="pagination-link" aria-label="Generalized Linear Models">
        <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb66" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multi-Factor ANOVA {#sec-multifactor-anova}</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to Factorial Designs</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>While one-way ANOVA compares groups defined by a single factor, many biological experiments manipulate multiple factors simultaneously. A factorial design examines all combinations of factor levels, allowing us to study not only the independent effect of each factor but also how factors interact with each other.</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>Consider an experiment testing the effects of both temperature and nutrient concentration on algal growth. A factorial design would include all combinations: high temperature with high nutrients, high temperature with low nutrients, low temperature with high nutrients, and low temperature with low nutrients. This approach is more efficient than conducting separate experiments for each factor, and it reveals interactions that single-factor designs would miss.</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>**Factorial designs** are characterized by:</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multiple factors (independent variables)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>All combinations of factor levels are tested</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ability to test for interactions between factors</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Greater efficiency than separate one-factor experiments</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>The notation $a \times b$ factorial design means factor A has $a$ levels and factor B has $b$ levels, producing $a \times b$ treatment combinations. A $2 \times 3$ design has 6 treatment groups; a $2 \times 2 \times 2$ design has 8 treatment groups.</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Two-Way ANOVA</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>Two-way ANOVA analyzes data from a two-factor experimental design. The model partitions variance into:</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Main effect of Factor A**: The average effect of Factor A across all levels of Factor B</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Main effect of Factor B**: The average effect of Factor B across all levels of Factor A</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Interaction effect (A × B)**: The extent to which the effect of one factor depends on the level of the other factor</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Residual (error)**: Unexplained variation within treatment groups</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>The statistical model is:</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>$$y_{ijk} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \epsilon_{ijk}$$</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mu$ is the grand mean</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\alpha_i$ is the effect of level $i$ of Factor A</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_j$ is the effect of level $j$ of Factor B</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$(\alpha\beta)_{ij}$ is the interaction effect</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\epsilon_{ijk}$ is the random error for observation $k$ in treatment combination $ij$</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-factorial-design</span></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Two-way ANOVA factorial design showing main effects and interaction"</span></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated factorial experiment: Temperature × Nutrient effects on growth</span></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">15</span>  <span class="co"># replicates per treatment</span></span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Create factorial design data</span></span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>temperature <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>), <span class="at">each =</span> <span class="dv">2</span><span class="sc">*</span>n)</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a>nutrient <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>), <span class="at">each =</span> n), <span class="dv">2</span>)</span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate growth with main effects AND interaction</span></span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Low temp &amp; low nutrient: baseline 10</span></span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a><span class="co"># High nutrient adds 5</span></span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a><span class="co"># High temp adds 3</span></span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a><span class="co"># BUT interaction: high temp × high nutrient gives extra boost of 4</span></span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>growth <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">4</span><span class="sc">*</span>n)</span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"Low"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">10</span>, <span class="fl">1.5</span>)</span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"High"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">15</span>, <span class="fl">1.5</span>)</span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"Low"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">13</span>, <span class="fl">1.5</span>)</span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a>growth[temperature <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"High"</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">22</span>, <span class="fl">1.5</span>)  <span class="co"># Synergistic effect</span></span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a>factorial_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature =</span> <span class="fu">factor</span>(temperature, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>)),</span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">nutrient =</span> <span class="fu">factor</span>(nutrient, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>)),</span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">growth =</span> growth</span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the design</span></span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(factorial_data, <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> growth, <span class="at">fill =</span> nutrient)) <span class="sc">+</span></span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Factorial Design: Temperature × Nutrient"</span>,</span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Each combination of factor levels is tested"</span>,</span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Growth Rate"</span>,</span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Nutrient</span><span class="sc">\n</span><span class="st">Level"</span>) <span class="sc">+</span></span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>)) <span class="sc">+</span></span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the two-way ANOVA model</span></span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a>factorial_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(growth <span class="sc">~</span> temperature <span class="sc">*</span> nutrient, <span class="at">data =</span> factorial_data)</span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(factorial_aov)</span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a>The ANOVA table shows three F-tests:</span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**temperature**: Tests whether the main effect of temperature is significant</span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**nutrient**: Tests whether the main effect of nutrient is significant</span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**temperature:nutrient**: Tests whether the interaction is significant</span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding Interactions</span></span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a>An **interaction** occurs when the effect of one factor depends on the level of another factor. Interactions are one of the most important features of factorial designs—they reveal that factors do not operate independently.</span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a>**Types of effects:**</span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Additive effects (no interaction)**: The effect of Factor A is the same regardless of Factor B's level. Effects simply add together.</span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Synergistic interaction**: The combined effect is greater than the sum of individual effects. For example, two drugs together might be more effective than expected from their individual effects.</span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Antagonistic interaction**: The combined effect is less than expected. One factor might diminish or reverse the effect of another.</span>
<span id="cb66-116"><a href="#cb66-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-117"><a href="#cb66-117" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interaction Plots</span></span>
<span id="cb66-118"><a href="#cb66-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-119"><a href="#cb66-119" aria-hidden="true" tabindex="-1"></a>The clearest way to understand interactions is through **interaction plots**, which show the mean response at each factor combination.</span>
<span id="cb66-120"><a href="#cb66-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-123"><a href="#cb66-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-124"><a href="#cb66-124" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-interaction-plot</span></span>
<span id="cb66-125"><a href="#cb66-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Interaction plot showing non-parallel lines indicating interaction between factors"</span></span>
<span id="cb66-126"><a href="#cb66-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-127"><a href="#cb66-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb66-128"><a href="#cb66-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-129"><a href="#cb66-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means for each combination</span></span>
<span id="cb66-130"><a href="#cb66-130" aria-hidden="true" tabindex="-1"></a>means_data <span class="ot">&lt;-</span> factorial_data <span class="sc">%&gt;%</span></span>
<span id="cb66-131"><a href="#cb66-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temperature, nutrient) <span class="sc">%&gt;%</span></span>
<span id="cb66-132"><a href="#cb66-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_growth =</span> <span class="fu">mean</span>(growth),</span>
<span id="cb66-133"><a href="#cb66-133" aria-hidden="true" tabindex="-1"></a>            <span class="at">se =</span> <span class="fu">sd</span>(growth) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">n</span>()),</span>
<span id="cb66-134"><a href="#cb66-134" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb66-135"><a href="#cb66-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-136"><a href="#cb66-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interaction plot</span></span>
<span id="cb66-137"><a href="#cb66-137" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(means_data, <span class="fu">aes</span>(<span class="at">x =</span> temperature, <span class="at">y =</span> mean_growth,</span>
<span id="cb66-138"><a href="#cb66-138" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> nutrient, <span class="at">group =</span> nutrient)) <span class="sc">+</span></span>
<span id="cb66-139"><a href="#cb66-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb66-140"><a href="#cb66-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb66-141"><a href="#cb66-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_growth <span class="sc">-</span> se, <span class="at">ymax =</span> mean_growth <span class="sc">+</span> se),</span>
<span id="cb66-142"><a href="#cb66-142" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-143"><a href="#cb66-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction Plot: Temperature × Nutrient"</span>,</span>
<span id="cb66-144"><a href="#cb66-144" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Non-parallel lines indicate an interaction effect"</span>,</span>
<span id="cb66-145"><a href="#cb66-145" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb66-146"><a href="#cb66-146" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Mean Growth Rate"</span>,</span>
<span id="cb66-147"><a href="#cb66-147" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Nutrient</span><span class="sc">\n</span><span class="st">Level"</span>) <span class="sc">+</span></span>
<span id="cb66-148"><a href="#cb66-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>)) <span class="sc">+</span></span>
<span id="cb66-149"><a href="#cb66-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb66-150"><a href="#cb66-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb66-151"><a href="#cb66-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-152"><a href="#cb66-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative: base R interaction.plot</span></span>
<span id="cb66-153"><a href="#cb66-153" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(</span>
<span id="cb66-154"><a href="#cb66-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.factor =</span> factorial_data<span class="sc">$</span>temperature,</span>
<span id="cb66-155"><a href="#cb66-155" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.factor =</span> factorial_data<span class="sc">$</span>nutrient,</span>
<span id="cb66-156"><a href="#cb66-156" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> factorial_data<span class="sc">$</span>growth,</span>
<span id="cb66-157"><a href="#cb66-157" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>),</span>
<span id="cb66-158"><a href="#cb66-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb66-159"><a href="#cb66-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Temperature"</span>,</span>
<span id="cb66-160"><a href="#cb66-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Mean Growth Rate"</span>,</span>
<span id="cb66-161"><a href="#cb66-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.label =</span> <span class="st">"Nutrient"</span></span>
<span id="cb66-162"><a href="#cb66-162" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-163"><a href="#cb66-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-164"><a href="#cb66-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-165"><a href="#cb66-165" aria-hidden="true" tabindex="-1"></a>**Interpreting interaction plots:**</span>
<span id="cb66-166"><a href="#cb66-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-167"><a href="#cb66-167" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Parallel lines** suggest no interaction—the effect of one factor is constant across levels of the other</span>
<span id="cb66-168"><a href="#cb66-168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Non-parallel lines** suggest an interaction—the effect of one factor changes depending on the other factor</span>
<span id="cb66-169"><a href="#cb66-169" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Crossing lines** indicate a strong interaction, potentially with a reversal of effects</span>
<span id="cb66-170"><a href="#cb66-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-171"><a href="#cb66-171" aria-hidden="true" tabindex="-1"></a><span class="al">![Illustration of interaction patterns showing parallel versus non-parallel lines](../images/ch26/ch26_interaction_patterns.jpeg)</span>{#fig-interaction-patterns fig-align="center"}</span>
<span id="cb66-172"><a href="#cb66-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-173"><a href="#cb66-173" aria-hidden="true" tabindex="-1"></a>The figure above illustrates common interaction patterns. In panel (a), parallel lines indicate no interaction—the effect of Factor A is the same at both levels of Factor B. In panel (b), non-parallel lines reveal an interaction—the effect of Factor A differs depending on Factor B's level.</span>
<span id="cb66-174"><a href="#cb66-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-175"><a href="#cb66-175" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting Main Effects vs Interactions</span></span>
<span id="cb66-176"><a href="#cb66-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-177"><a href="#cb66-177" aria-hidden="true" tabindex="-1"></a>When a significant interaction exists, interpreting main effects requires caution. The main effect represents an average across levels of the other factor, but if there's an interaction, this average may not meaningfully represent what happens at any particular level.</span>
<span id="cb66-178"><a href="#cb66-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-179"><a href="#cb66-179" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb66-180"><a href="#cb66-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## When Interactions are Present</span></span>
<span id="cb66-181"><a href="#cb66-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-182"><a href="#cb66-182" aria-hidden="true" tabindex="-1"></a>If the interaction is significant, focus on **simple effects**—the effect of one factor at each level of the other factor—rather than main effects. The main effect is an average that may obscure important differences.</span>
<span id="cb66-183"><a href="#cb66-183" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb66-184"><a href="#cb66-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-185"><a href="#cb66-185" aria-hidden="true" tabindex="-1"></a>**Simple effects analysis** examines the effect of one factor separately at each level of the other factor:</span>
<span id="cb66-186"><a href="#cb66-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-189"><a href="#cb66-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-190"><a href="#cb66-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple effects: effect of nutrient at each temperature level</span></span>
<span id="cb66-191"><a href="#cb66-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Low temperature</span></span>
<span id="cb66-192"><a href="#cb66-192" aria-hidden="true" tabindex="-1"></a>low_temp_data <span class="ot">&lt;-</span> factorial_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(temperature <span class="sc">==</span> <span class="st">"Low"</span>)</span>
<span id="cb66-193"><a href="#cb66-193" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(growth <span class="sc">~</span> nutrient, <span class="at">data =</span> low_temp_data)</span>
<span id="cb66-194"><a href="#cb66-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-195"><a href="#cb66-195" aria-hidden="true" tabindex="-1"></a><span class="co"># High temperature</span></span>
<span id="cb66-196"><a href="#cb66-196" aria-hidden="true" tabindex="-1"></a>high_temp_data <span class="ot">&lt;-</span> factorial_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(temperature <span class="sc">==</span> <span class="st">"High"</span>)</span>
<span id="cb66-197"><a href="#cb66-197" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(growth <span class="sc">~</span> nutrient, <span class="at">data =</span> high_temp_data)</span>
<span id="cb66-198"><a href="#cb66-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-199"><a href="#cb66-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-200"><a href="#cb66-200" aria-hidden="true" tabindex="-1"></a>In our example, the nutrient effect is significant at both temperatures, but the magnitude differs—the interaction shows that the nutrient boost is stronger at high temperature.</span>
<span id="cb66-201"><a href="#cb66-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-202"><a href="#cb66-202" aria-hidden="true" tabindex="-1"></a><span class="fu">## ANCOVA: Analysis of Covariance</span></span>
<span id="cb66-203"><a href="#cb66-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-204"><a href="#cb66-204" aria-hidden="true" tabindex="-1"></a>**Analysis of Covariance (ANCOVA)** combines ANOVA with regression by including both categorical factors and continuous covariates. The covariate is a continuous variable that you want to control for—it's not a treatment you manipulate, but a source of variation you want to account for.</span>
<span id="cb66-205"><a href="#cb66-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-206"><a href="#cb66-206" aria-hidden="true" tabindex="-1"></a>**Common uses of ANCOVA:**</span>
<span id="cb66-207"><a href="#cb66-207" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Controlling for pre-existing differences (baseline measurements)</span>
<span id="cb66-208"><a href="#cb66-208" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increasing precision by removing variance explained by the covariate</span>
<span id="cb66-209"><a href="#cb66-209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adjusting for confounding variables</span>
<span id="cb66-210"><a href="#cb66-210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Testing whether regression slopes differ across groups</span>
<span id="cb66-211"><a href="#cb66-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-212"><a href="#cb66-212" aria-hidden="true" tabindex="-1"></a><span class="fu">### The ANCOVA Model</span></span>
<span id="cb66-213"><a href="#cb66-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-214"><a href="#cb66-214" aria-hidden="true" tabindex="-1"></a>The ANCOVA model for one factor and one covariate is:</span>
<span id="cb66-215"><a href="#cb66-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-216"><a href="#cb66-216" aria-hidden="true" tabindex="-1"></a>$$y_{ij} = \mu + \alpha_i + \beta(x_{ij} - \bar{x}) + \epsilon_{ij}$$</span>
<span id="cb66-217"><a href="#cb66-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-218"><a href="#cb66-218" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb66-219"><a href="#cb66-219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mu$ is the overall mean</span>
<span id="cb66-220"><a href="#cb66-220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\alpha_i$ is the effect of group $i$</span>
<span id="cb66-221"><a href="#cb66-221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta$ is the regression slope (common to all groups)</span>
<span id="cb66-222"><a href="#cb66-222" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$x_{ij}$ is the covariate value</span>
<span id="cb66-223"><a href="#cb66-223" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\bar{x}$ is the mean of the covariate</span>
<span id="cb66-224"><a href="#cb66-224" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\epsilon_{ij}$ is the random error</span>
<span id="cb66-225"><a href="#cb66-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-226"><a href="#cb66-226" aria-hidden="true" tabindex="-1"></a>The key assumption is that the relationship between the covariate and response has the **same slope in all groups** (homogeneity of regression slopes).</span>
<span id="cb66-227"><a href="#cb66-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-230"><a href="#cb66-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-231"><a href="#cb66-231" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ancova-example</span></span>
<span id="cb66-232"><a href="#cb66-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "ANCOVA example showing treatment effects on final weight while controlling for initial weight"</span></span>
<span id="cb66-233"><a href="#cb66-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-234"><a href="#cb66-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb66-235"><a href="#cb66-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-236"><a href="#cb66-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated ANCOVA example: Effect of diet on final weight, controlling for initial weight</span></span>
<span id="cb66-237"><a href="#cb66-237" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">567</span>)</span>
<span id="cb66-238"><a href="#cb66-238" aria-hidden="true" tabindex="-1"></a>n_per_group <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb66-239"><a href="#cb66-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-240"><a href="#cb66-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Three diet treatments</span></span>
<span id="cb66-241"><a href="#cb66-241" aria-hidden="true" tabindex="-1"></a>diet_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-242"><a href="#cb66-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">diet =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Low-fat"</span>, <span class="st">"High-protein"</span>), <span class="at">each =</span> n_per_group)),</span>
<span id="cb66-243"><a href="#cb66-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial_weight =</span> <span class="fu">c</span>(</span>
<span id="cb66-244"><a href="#cb66-244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(n_per_group, <span class="dv">75</span>, <span class="dv">8</span>),   <span class="co"># Control group</span></span>
<span id="cb66-245"><a href="#cb66-245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(n_per_group, <span class="dv">78</span>, <span class="dv">8</span>),   <span class="co"># Low-fat (slightly heavier initially)</span></span>
<span id="cb66-246"><a href="#cb66-246" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(n_per_group, <span class="dv">73</span>, <span class="dv">8</span>)    <span class="co"># High-protein (slightly lighter initially)</span></span>
<span id="cb66-247"><a href="#cb66-247" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-248"><a href="#cb66-248" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb66-249"><a href="#cb66-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-250"><a href="#cb66-250" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final weight depends on diet AND initial weight</span></span>
<span id="cb66-251"><a href="#cb66-251" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Diet effects: Control = 0, Low-fat = -3, High-protein = -5</span></span>
<span id="cb66-252"><a href="#cb66-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">diet_effect =</span> <span class="fu">case_when</span>(</span>
<span id="cb66-253"><a href="#cb66-253" aria-hidden="true" tabindex="-1"></a>      diet <span class="sc">==</span> <span class="st">"Control"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb66-254"><a href="#cb66-254" aria-hidden="true" tabindex="-1"></a>      diet <span class="sc">==</span> <span class="st">"Low-fat"</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb66-255"><a href="#cb66-255" aria-hidden="true" tabindex="-1"></a>      diet <span class="sc">==</span> <span class="st">"High-protein"</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">5</span></span>
<span id="cb66-256"><a href="#cb66-256" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb66-257"><a href="#cb66-257" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final weight = initial + diet effect + some regression to mean + noise</span></span>
<span id="cb66-258"><a href="#cb66-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">final_weight =</span> initial_weight <span class="sc">+</span> diet_effect <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> (initial_weight <span class="sc">-</span> <span class="dv">75</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb66-259"><a href="#cb66-259" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-260"><a href="#cb66-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-261"><a href="#cb66-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the ANCOVA setup</span></span>
<span id="cb66-262"><a href="#cb66-262" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diet_data, <span class="fu">aes</span>(<span class="at">x =</span> initial_weight, <span class="at">y =</span> final_weight, <span class="at">color =</span> diet)) <span class="sc">+</span></span>
<span id="cb66-263"><a href="#cb66-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-264"><a href="#cb66-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-265"><a href="#cb66-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ANCOVA: Diet Effect on Final Weight"</span>,</span>
<span id="cb66-266"><a href="#cb66-266" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Parallel regression lines show diet effects while controlling for initial weight"</span>,</span>
<span id="cb66-267"><a href="#cb66-267" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Initial Weight (kg)"</span>,</span>
<span id="cb66-268"><a href="#cb66-268" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Final Weight (kg)"</span>,</span>
<span id="cb66-269"><a href="#cb66-269" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb66-270"><a href="#cb66-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Control"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Low-fat"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"High-protein"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>)) <span class="sc">+</span></span>
<span id="cb66-271"><a href="#cb66-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb66-272"><a href="#cb66-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-273"><a href="#cb66-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-274"><a href="#cb66-274" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting ANCOVA in R</span></span>
<span id="cb66-275"><a href="#cb66-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-278"><a href="#cb66-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-279"><a href="#cb66-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANCOVA model</span></span>
<span id="cb66-280"><a href="#cb66-280" aria-hidden="true" tabindex="-1"></a>ancova_model <span class="ot">&lt;-</span> <span class="fu">aov</span>(final_weight <span class="sc">~</span> initial_weight <span class="sc">+</span> diet, <span class="at">data =</span> diet_data)</span>
<span id="cb66-281"><a href="#cb66-281" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ancova_model)</span>
<span id="cb66-282"><a href="#cb66-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-283"><a href="#cb66-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-284"><a href="#cb66-284" aria-hidden="true" tabindex="-1"></a>Note the order of terms: the covariate (<span class="in">`initial_weight`</span>) is entered first to remove its effect before testing the factor (<span class="in">`diet`</span>).</span>
<span id="cb66-285"><a href="#cb66-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-288"><a href="#cb66-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-289"><a href="#cb66-289" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to ANOVA without covariate</span></span>
<span id="cb66-290"><a href="#cb66-290" aria-hidden="true" tabindex="-1"></a>anova_only <span class="ot">&lt;-</span> <span class="fu">aov</span>(final_weight <span class="sc">~</span> diet, <span class="at">data =</span> diet_data)</span>
<span id="cb66-291"><a href="#cb66-291" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(anova_only)</span>
<span id="cb66-292"><a href="#cb66-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-293"><a href="#cb66-293" aria-hidden="true" tabindex="-1"></a><span class="co"># The ANCOVA has smaller residual SS and more power</span></span>
<span id="cb66-294"><a href="#cb66-294" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Residual SS (ANOVA):"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">residuals</span>(anova_only)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-295"><a href="#cb66-295" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Residual SS (ANCOVA):"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">residuals</span>(ancova_model)<span class="sc">^</span><span class="dv">2</span>), <span class="dv">1</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb66-296"><a href="#cb66-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-297"><a href="#cb66-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-298"><a href="#cb66-298" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adjusted Means</span></span>
<span id="cb66-299"><a href="#cb66-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-300"><a href="#cb66-300" aria-hidden="true" tabindex="-1"></a>ANCOVA produces **adjusted means**—the group means estimated at the overall mean of the covariate. These are the means we would expect if all groups had started with the same covariate value.</span>
<span id="cb66-301"><a href="#cb66-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-304"><a href="#cb66-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-305"><a href="#cb66-305" aria-hidden="true" tabindex="-1"></a><span class="co"># Get adjusted means</span></span>
<span id="cb66-306"><a href="#cb66-306" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb66-307"><a href="#cb66-307" aria-hidden="true" tabindex="-1"></a>ancova_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(ancova_model, <span class="st">"diet"</span>)</span>
<span id="cb66-308"><a href="#cb66-308" aria-hidden="true" tabindex="-1"></a>ancova_emm</span>
<span id="cb66-309"><a href="#cb66-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-310"><a href="#cb66-310" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons of adjusted means</span></span>
<span id="cb66-311"><a href="#cb66-311" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(ancova_emm, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span>
<span id="cb66-312"><a href="#cb66-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-313"><a href="#cb66-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-314"><a href="#cb66-314" aria-hidden="true" tabindex="-1"></a><span class="fu">### Testing Homogeneity of Slopes</span></span>
<span id="cb66-315"><a href="#cb66-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-316"><a href="#cb66-316" aria-hidden="true" tabindex="-1"></a>A critical assumption is that regression slopes are equal across groups. Test this by including the interaction term:</span>
<span id="cb66-317"><a href="#cb66-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-320"><a href="#cb66-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-321"><a href="#cb66-321" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for unequal slopes (interaction between covariate and factor)</span></span>
<span id="cb66-322"><a href="#cb66-322" aria-hidden="true" tabindex="-1"></a>slope_test <span class="ot">&lt;-</span> <span class="fu">aov</span>(final_weight <span class="sc">~</span> initial_weight <span class="sc">*</span> diet, <span class="at">data =</span> diet_data)</span>
<span id="cb66-323"><a href="#cb66-323" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(slope_test)</span>
<span id="cb66-324"><a href="#cb66-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-325"><a href="#cb66-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-326"><a href="#cb66-326" aria-hidden="true" tabindex="-1"></a>A significant interaction indicates slopes differ across groups, violating the ANCOVA assumption. In that case, you should:</span>
<span id="cb66-327"><a href="#cb66-327" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Report separate regressions for each group</span>
<span id="cb66-328"><a href="#cb66-328" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Use a more complex model (separate slopes ANCOVA)</span>
<span id="cb66-329"><a href="#cb66-329" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Consider whether the interaction itself is scientifically meaningful</span>
<span id="cb66-330"><a href="#cb66-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-333"><a href="#cb66-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-334"><a href="#cb66-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-ancova-slopes</span></span>
<span id="cb66-335"><a href="#cb66-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Testing homogeneity of slopes: parallel lines indicate the assumption is met"</span></span>
<span id="cb66-336"><a href="#cb66-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-337"><a href="#cb66-337" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb66-338"><a href="#cb66-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-339"><a href="#cb66-339" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize slopes by group</span></span>
<span id="cb66-340"><a href="#cb66-340" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diet_data, <span class="fu">aes</span>(<span class="at">x =</span> initial_weight, <span class="at">y =</span> final_weight, <span class="at">color =</span> diet)) <span class="sc">+</span></span>
<span id="cb66-341"><a href="#cb66-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb66-342"><a href="#cb66-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb66-343"><a href="#cb66-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Testing Homogeneity of Regression Slopes"</span>,</span>
<span id="cb66-344"><a href="#cb66-344" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Slopes should be approximately parallel for valid ANCOVA"</span>,</span>
<span id="cb66-345"><a href="#cb66-345" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Initial Weight (kg)"</span>,</span>
<span id="cb66-346"><a href="#cb66-346" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Final Weight (kg)"</span>,</span>
<span id="cb66-347"><a href="#cb66-347" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Diet"</span>) <span class="sc">+</span></span>
<span id="cb66-348"><a href="#cb66-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Control"</span> <span class="ot">=</span> <span class="st">"#E69F00"</span>, <span class="st">"Low-fat"</span> <span class="ot">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"High-protein"</span> <span class="ot">=</span> <span class="st">"#009E73"</span>)) <span class="sc">+</span></span>
<span id="cb66-349"><a href="#cb66-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb66-350"><a href="#cb66-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-351"><a href="#cb66-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-352"><a href="#cb66-352" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb66-353"><a href="#cb66-353" aria-hidden="true" tabindex="-1"></a><span class="fu">## ANCOVA Assumptions</span></span>
<span id="cb66-354"><a href="#cb66-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-355"><a href="#cb66-355" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Independence** of observations</span>
<span id="cb66-356"><a href="#cb66-356" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Normality** of residuals</span>
<span id="cb66-357"><a href="#cb66-357" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Homogeneity of variance** across groups</span>
<span id="cb66-358"><a href="#cb66-358" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Linear relationship** between covariate and response</span>
<span id="cb66-359"><a href="#cb66-359" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Homogeneity of regression slopes** (equal slopes across groups)</span>
<span id="cb66-360"><a href="#cb66-360" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Covariate measured without error** (or with negligible error)</span>
<span id="cb66-361"><a href="#cb66-361" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Covariate independent of treatment** (especially important in observational studies)</span>
<span id="cb66-362"><a href="#cb66-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-363"><a href="#cb66-363" aria-hidden="true" tabindex="-1"></a>The last assumption is critical: if the treatment affects the covariate, ANCOVA can remove real treatment effects. The covariate should ideally be measured before treatment is applied.</span>
<span id="cb66-364"><a href="#cb66-364" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb66-365"><a href="#cb66-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-366"><a href="#cb66-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Use ANCOVA</span></span>
<span id="cb66-367"><a href="#cb66-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-368"><a href="#cb66-368" aria-hidden="true" tabindex="-1"></a>**Use ANCOVA when:**</span>
<span id="cb66-369"><a href="#cb66-369" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You have a continuous covariate measured before treatment</span>
<span id="cb66-370"><a href="#cb66-370" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>You want to increase precision by accounting for baseline variation</span>
<span id="cb66-371"><a href="#cb66-371" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Groups differ on the covariate (but not due to treatment)</span>
<span id="cb66-372"><a href="#cb66-372" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The covariate-response relationship is linear with equal slopes</span>
<span id="cb66-373"><a href="#cb66-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-374"><a href="#cb66-374" aria-hidden="true" tabindex="-1"></a>**Avoid ANCOVA when:**</span>
<span id="cb66-375"><a href="#cb66-375" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The covariate is affected by treatment</span>
<span id="cb66-376"><a href="#cb66-376" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Slopes clearly differ across groups</span>
<span id="cb66-377"><a href="#cb66-377" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The covariate is categorical (use factorial ANOVA instead)</span>
<span id="cb66-378"><a href="#cb66-378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Sample sizes are very small</span>
<span id="cb66-379"><a href="#cb66-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-380"><a href="#cb66-380" aria-hidden="true" tabindex="-1"></a><span class="fu">## Nested Designs</span></span>
<span id="cb66-381"><a href="#cb66-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-382"><a href="#cb66-382" aria-hidden="true" tabindex="-1"></a>In **nested designs**, levels of one factor exist only within levels of another factor. This differs from a factorial design where all combinations of factors are crossed.</span>
<span id="cb66-383"><a href="#cb66-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-384"><a href="#cb66-384" aria-hidden="true" tabindex="-1"></a>**Common examples in biology:**</span>
<span id="cb66-385"><a href="#cb66-385" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Students nested within classrooms (each student is in only one classroom)</span>
<span id="cb66-386"><a href="#cb66-386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Samples nested within sites (each sample comes from one site)</span>
<span id="cb66-387"><a href="#cb66-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Technicians nested within labs (each technician works in one lab)</span>
<span id="cb66-388"><a href="#cb66-388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Subsamples nested within experimental units</span>
<span id="cb66-389"><a href="#cb66-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-390"><a href="#cb66-390" aria-hidden="true" tabindex="-1"></a>In a nested design, we cannot estimate an interaction because not all factor combinations exist. The nested factor is typically a random effect representing sampling variability.</span>
<span id="cb66-391"><a href="#cb66-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-392"><a href="#cb66-392" aria-hidden="true" tabindex="-1"></a>**Notation:** Factor B is nested within Factor A, written as B(A) or B/A.</span>
<span id="cb66-393"><a href="#cb66-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-396"><a href="#cb66-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-397"><a href="#cb66-397" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-nested-design</span></span>
<span id="cb66-398"><a href="#cb66-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Nested design example: technicians nested within labs"</span></span>
<span id="cb66-399"><a href="#cb66-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-400"><a href="#cb66-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb66-401"><a href="#cb66-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-402"><a href="#cb66-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated nested design: Technicians (nested within Labs)</span></span>
<span id="cb66-403"><a href="#cb66-403" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb66-404"><a href="#cb66-404" aria-hidden="true" tabindex="-1"></a>n_labs <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb66-405"><a href="#cb66-405" aria-hidden="true" tabindex="-1"></a>n_techs_per_lab <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb66-406"><a href="#cb66-406" aria-hidden="true" tabindex="-1"></a>n_measurements <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb66-407"><a href="#cb66-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-408"><a href="#cb66-408" aria-hidden="true" tabindex="-1"></a>lab <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"Lab"</span>, <span class="dv">1</span><span class="sc">:</span>n_labs), <span class="at">each =</span> n_techs_per_lab <span class="sc">*</span> n_measurements)</span>
<span id="cb66-409"><a href="#cb66-409" aria-hidden="true" tabindex="-1"></a>tech <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"Tech"</span>, <span class="dv">1</span><span class="sc">:</span>(n_labs <span class="sc">*</span> n_techs_per_lab)), <span class="at">each =</span> n_measurements)</span>
<span id="cb66-410"><a href="#cb66-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-411"><a href="#cb66-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Lab effects (fixed)</span></span>
<span id="cb66-412"><a href="#cb66-412" aria-hidden="true" tabindex="-1"></a>lab_effects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">105</span>, <span class="dv">110</span>)</span>
<span id="cb66-413"><a href="#cb66-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Technician effects (random, nested within labs)</span></span>
<span id="cb66-414"><a href="#cb66-414" aria-hidden="true" tabindex="-1"></a>tech_effects <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_labs <span class="sc">*</span> n_techs_per_lab, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb66-415"><a href="#cb66-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-416"><a href="#cb66-416" aria-hidden="true" tabindex="-1"></a>measurement <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(lab))</span>
<span id="cb66-417"><a href="#cb66-417" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lab)) {</span>
<span id="cb66-418"><a href="#cb66-418" aria-hidden="true" tabindex="-1"></a>  lab_idx <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(lab[i], <span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb66-419"><a href="#cb66-419" aria-hidden="true" tabindex="-1"></a>  tech_idx <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(tech[i], <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb66-420"><a href="#cb66-420" aria-hidden="true" tabindex="-1"></a>  measurement[i] <span class="ot">&lt;-</span> lab_effects[lab_idx] <span class="sc">+</span> tech_effects[tech_idx] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb66-421"><a href="#cb66-421" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-422"><a href="#cb66-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-423"><a href="#cb66-423" aria-hidden="true" tabindex="-1"></a>nested_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-424"><a href="#cb66-424" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab =</span> <span class="fu">factor</span>(lab),</span>
<span id="cb66-425"><a href="#cb66-425" aria-hidden="true" tabindex="-1"></a>  <span class="at">tech =</span> <span class="fu">factor</span>(tech),</span>
<span id="cb66-426"><a href="#cb66-426" aria-hidden="true" tabindex="-1"></a>  <span class="at">measurement =</span> measurement</span>
<span id="cb66-427"><a href="#cb66-427" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-428"><a href="#cb66-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-429"><a href="#cb66-429" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize nested structure</span></span>
<span id="cb66-430"><a href="#cb66-430" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nested_data, <span class="fu">aes</span>(<span class="at">x =</span> tech, <span class="at">y =</span> measurement, <span class="at">color =</span> lab)) <span class="sc">+</span></span>
<span id="cb66-431"><a href="#cb66-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-432"><a href="#cb66-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb66-433"><a href="#cb66-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb66-434"><a href="#cb66-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Nested Design: Technicians within Labs"</span>,</span>
<span id="cb66-435"><a href="#cb66-435" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Each technician works in only one lab"</span>,</span>
<span id="cb66-436"><a href="#cb66-436" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Technician"</span>,</span>
<span id="cb66-437"><a href="#cb66-437" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Measurement"</span>) <span class="sc">+</span></span>
<span id="cb66-438"><a href="#cb66-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb66-439"><a href="#cb66-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb66-440"><a href="#cb66-440" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb66-441"><a href="#cb66-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-442"><a href="#cb66-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-445"><a href="#cb66-445" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-446"><a href="#cb66-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis of nested design</span></span>
<span id="cb66-447"><a href="#cb66-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Technician is nested within lab: tech %in% lab or tech/lab</span></span>
<span id="cb66-448"><a href="#cb66-448" aria-hidden="true" tabindex="-1"></a>nested_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(measurement <span class="sc">~</span> lab <span class="sc">+</span> <span class="fu">Error</span>(tech <span class="sc">%in%</span> lab), <span class="at">data =</span> nested_data)</span>
<span id="cb66-449"><a href="#cb66-449" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nested_aov)</span>
<span id="cb66-450"><a href="#cb66-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-451"><a href="#cb66-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative using lme4 for mixed effects</span></span>
<span id="cb66-452"><a href="#cb66-452" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb66-453"><a href="#cb66-453" aria-hidden="true" tabindex="-1"></a>nested_lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(measurement <span class="sc">~</span> lab <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>lab<span class="sc">:</span>tech), <span class="at">data =</span> nested_data)</span>
<span id="cb66-454"><a href="#cb66-454" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nested_lmer)</span>
<span id="cb66-455"><a href="#cb66-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-456"><a href="#cb66-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-457"><a href="#cb66-457" aria-hidden="true" tabindex="-1"></a>The nested design partitions variance into:</span>
<span id="cb66-458"><a href="#cb66-458" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Between labs** (fixed effect)</span>
<span id="cb66-459"><a href="#cb66-459" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Between technicians within labs** (random effect)</span>
<span id="cb66-460"><a href="#cb66-460" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Within technicians** (residual error)</span>
<span id="cb66-461"><a href="#cb66-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-462"><a href="#cb66-462" aria-hidden="true" tabindex="-1"></a><span class="fu">## Repeated Measures ANOVA</span></span>
<span id="cb66-463"><a href="#cb66-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-464"><a href="#cb66-464" aria-hidden="true" tabindex="-1"></a>When the same subjects are measured multiple times under different conditions, observations are not independent. **Repeated measures ANOVA** accounts for the correlation structure in the data by treating subjects as a blocking factor or random effect.</span>
<span id="cb66-465"><a href="#cb66-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-466"><a href="#cb66-466" aria-hidden="true" tabindex="-1"></a>**Advantages:**</span>
<span id="cb66-467"><a href="#cb66-467" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Increased statistical power (controls for individual differences)</span>
<span id="cb66-468"><a href="#cb66-468" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Requires fewer subjects</span>
<span id="cb66-469"><a href="#cb66-469" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Each subject serves as their own control</span>
<span id="cb66-470"><a href="#cb66-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-471"><a href="#cb66-471" aria-hidden="true" tabindex="-1"></a>**Assumptions:**</span>
<span id="cb66-472"><a href="#cb66-472" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sphericity**: The variance of differences between all pairs of repeated measures should be equal</span>
<span id="cb66-473"><a href="#cb66-473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Violations of sphericity can be corrected using Greenhouse-Geisser or Huynh-Feldt adjustments</span>
<span id="cb66-474"><a href="#cb66-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-477"><a href="#cb66-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-478"><a href="#cb66-478" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-repeated-measures</span></span>
<span id="cb66-479"><a href="#cb66-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Repeated measures design showing within-subject changes over time"</span></span>
<span id="cb66-480"><a href="#cb66-480" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-481"><a href="#cb66-481" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb66-482"><a href="#cb66-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-483"><a href="#cb66-483" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated repeated measures: Drug effect over time</span></span>
<span id="cb66-484"><a href="#cb66-484" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb66-485"><a href="#cb66-485" aria-hidden="true" tabindex="-1"></a>n_subjects <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb66-486"><a href="#cb66-486" aria-hidden="true" tabindex="-1"></a>timepoints <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Baseline"</span>, <span class="st">"Week_1"</span>, <span class="st">"Week_2"</span>, <span class="st">"Week_4"</span>)</span>
<span id="cb66-487"><a href="#cb66-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-488"><a href="#cb66-488" aria-hidden="true" tabindex="-1"></a><span class="co"># Each subject has a baseline level</span></span>
<span id="cb66-489"><a href="#cb66-489" aria-hidden="true" tabindex="-1"></a>baseline_values <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_subjects, <span class="dv">50</span>, <span class="dv">10</span>)</span>
<span id="cb66-490"><a href="#cb66-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-491"><a href="#cb66-491" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment effect increases over time</span></span>
<span id="cb66-492"><a href="#cb66-492" aria-hidden="true" tabindex="-1"></a>time_effects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">6</span>, <span class="sc">-</span><span class="dv">8</span>)</span>
<span id="cb66-493"><a href="#cb66-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-494"><a href="#cb66-494" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data</span></span>
<span id="cb66-495"><a href="#cb66-495" aria-hidden="true" tabindex="-1"></a>rm_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb66-496"><a href="#cb66-496" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>n_subjects),</span>
<span id="cb66-497"><a href="#cb66-497" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">factor</span>(timepoints, <span class="at">levels =</span> timepoints)</span>
<span id="cb66-498"><a href="#cb66-498" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb66-499"><a href="#cb66-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subject, time) <span class="sc">%&gt;%</span></span>
<span id="cb66-500"><a href="#cb66-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-501"><a href="#cb66-501" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseline =</span> <span class="fu">rep</span>(baseline_values, <span class="at">each =</span> <span class="fu">length</span>(timepoints)),</span>
<span id="cb66-502"><a href="#cb66-502" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_num =</span> <span class="fu">as.numeric</span>(time),</span>
<span id="cb66-503"><a href="#cb66-503" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> baseline <span class="sc">+</span> time_effects[time_num] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb66-504"><a href="#cb66-504" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-505"><a href="#cb66-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-506"><a href="#cb66-506" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize repeated measures</span></span>
<span id="cb66-507"><a href="#cb66-507" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rm_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> response, <span class="at">group =</span> subject)) <span class="sc">+</span></span>
<span id="cb66-508"><a href="#cb66-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb66-509"><a href="#cb66-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-510"><a href="#cb66-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb66-511"><a href="#cb66-511" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb66-512"><a href="#cb66-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="dv">1</span>), <span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb66-513"><a href="#cb66-513" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb66-514"><a href="#cb66-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Repeated Measures: Drug Response Over Time"</span>,</span>
<span id="cb66-515"><a href="#cb66-515" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Gray lines show individual subjects; red line shows mean response"</span>,</span>
<span id="cb66-516"><a href="#cb66-516" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb66-517"><a href="#cb66-517" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Response Variable"</span>) <span class="sc">+</span></span>
<span id="cb66-518"><a href="#cb66-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb66-519"><a href="#cb66-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-520"><a href="#cb66-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-523"><a href="#cb66-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-524"><a href="#cb66-524" aria-hidden="true" tabindex="-1"></a><span class="co"># Traditional repeated measures ANOVA</span></span>
<span id="cb66-525"><a href="#cb66-525" aria-hidden="true" tabindex="-1"></a><span class="co"># Error term specifies within-subject factor</span></span>
<span id="cb66-526"><a href="#cb66-526" aria-hidden="true" tabindex="-1"></a>rm_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(response <span class="sc">~</span> time <span class="sc">+</span> <span class="fu">Error</span>(subject<span class="sc">/</span>time), <span class="at">data =</span> rm_data)</span>
<span id="cb66-527"><a href="#cb66-527" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rm_aov)</span>
<span id="cb66-528"><a href="#cb66-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-529"><a href="#cb66-529" aria-hidden="true" tabindex="-1"></a><span class="co"># Check sphericity assumption</span></span>
<span id="cb66-530"><a href="#cb66-530" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb66-531"><a href="#cb66-531" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to wide format for Mauchly's test</span></span>
<span id="cb66-532"><a href="#cb66-532" aria-hidden="true" tabindex="-1"></a>rm_wide <span class="ot">&lt;-</span> rm_data <span class="sc">%&gt;%</span></span>
<span id="cb66-533"><a href="#cb66-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject, time, response) <span class="sc">%&gt;%</span></span>
<span id="cb66-534"><a href="#cb66-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time, <span class="at">values_from =</span> response)</span>
<span id="cb66-535"><a href="#cb66-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-536"><a href="#cb66-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative: Use mixed effects model (handles violations better)</span></span>
<span id="cb66-537"><a href="#cb66-537" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb66-538"><a href="#cb66-538" aria-hidden="true" tabindex="-1"></a>rm_lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(response <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>subject), <span class="at">data =</span> rm_data)</span>
<span id="cb66-539"><a href="#cb66-539" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rm_lmer)</span>
<span id="cb66-540"><a href="#cb66-540" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(rm_lmer)</span>
<span id="cb66-541"><a href="#cb66-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-542"><a href="#cb66-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-543"><a href="#cb66-543" aria-hidden="true" tabindex="-1"></a>**Post-hoc tests for repeated measures:**</span>
<span id="cb66-544"><a href="#cb66-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-547"><a href="#cb66-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-548"><a href="#cb66-548" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons with correction for multiple testing</span></span>
<span id="cb66-549"><a href="#cb66-549" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb66-550"><a href="#cb66-550" aria-hidden="true" tabindex="-1"></a>rm_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(rm_lmer, <span class="st">"time"</span>)</span>
<span id="cb66-551"><a href="#cb66-551" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(rm_emm, <span class="at">adjust =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb66-552"><a href="#cb66-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-553"><a href="#cb66-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-554"><a href="#cb66-554" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mixed Effects Models</span></span>
<span id="cb66-555"><a href="#cb66-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-556"><a href="#cb66-556" aria-hidden="true" tabindex="-1"></a>**Mixed effects models** (also called **multilevel models** or **hierarchical models**) include both **fixed effects** (factors of primary interest) and **random effects** (sources of random variation).</span>
<span id="cb66-557"><a href="#cb66-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-558"><a href="#cb66-558" aria-hidden="true" tabindex="-1"></a>**When to use mixed effects models:**</span>
<span id="cb66-559"><a href="#cb66-559" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Repeated measures or longitudinal data</span>
<span id="cb66-560"><a href="#cb66-560" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nested or hierarchical data structures</span>
<span id="cb66-561"><a href="#cb66-561" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Multiple sources of random variation</span>
<span id="cb66-562"><a href="#cb66-562" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unbalanced designs or missing data</span>
<span id="cb66-563"><a href="#cb66-563" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Continuous covariates combined with grouping factors</span>
<span id="cb66-564"><a href="#cb66-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-565"><a href="#cb66-565" aria-hidden="true" tabindex="-1"></a>**Fixed vs Random Effects:**</span>
<span id="cb66-566"><a href="#cb66-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-567"><a href="#cb66-567" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Fixed effects**: Specific levels you chose (e.g., specific drug treatments, particular temperatures)</span>
<span id="cb66-568"><a href="#cb66-568" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Random effects**: Levels sampled from a larger population (e.g., subjects, batches, field sites)</span>
<span id="cb66-569"><a href="#cb66-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-570"><a href="#cb66-570" aria-hidden="true" tabindex="-1"></a>The <span class="in">`lme4`</span> package in R provides powerful tools for mixed effects models:</span>
<span id="cb66-571"><a href="#cb66-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-574"><a href="#cb66-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-575"><a href="#cb66-575" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Growth curve with random intercepts and slopes</span></span>
<span id="cb66-576"><a href="#cb66-576" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb66-577"><a href="#cb66-577" aria-hidden="true" tabindex="-1"></a>n_individuals <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb66-578"><a href="#cb66-578" aria-hidden="true" tabindex="-1"></a>n_timepoints <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb66-579"><a href="#cb66-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-580"><a href="#cb66-580" aria-hidden="true" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb66-581"><a href="#cb66-581" aria-hidden="true" tabindex="-1"></a>  <span class="at">individual =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>n_individuals),</span>
<span id="cb66-582"><a href="#cb66-582" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">0</span><span class="sc">:</span>(n_timepoints<span class="dv">-1</span>)</span>
<span id="cb66-583"><a href="#cb66-583" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb66-584"><a href="#cb66-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-585"><a href="#cb66-585" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random intercept for each individual</span></span>
<span id="cb66-586"><a href="#cb66-586" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_individuals, <span class="dv">5</span>, <span class="dv">1</span>), <span class="at">each =</span> n_timepoints),</span>
<span id="cb66-587"><a href="#cb66-587" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random slope for each individual</span></span>
<span id="cb66-588"><a href="#cb66-588" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(n_individuals, <span class="fl">0.8</span>, <span class="fl">0.15</span>), <span class="at">each =</span> n_timepoints),</span>
<span id="cb66-589"><a href="#cb66-589" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate size with individual variation</span></span>
<span id="cb66-590"><a href="#cb66-590" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> intercept <span class="sc">+</span> slope <span class="sc">*</span> time <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb66-591"><a href="#cb66-591" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-592"><a href="#cb66-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-593"><a href="#cb66-593" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit mixed effects model with random intercepts and slopes</span></span>
<span id="cb66-594"><a href="#cb66-594" aria-hidden="true" tabindex="-1"></a>mixed_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(size <span class="sc">~</span> time <span class="sc">+</span> (time<span class="sc">|</span>individual), <span class="at">data =</span> growth_data)</span>
<span id="cb66-595"><a href="#cb66-595" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mixed_model)</span>
<span id="cb66-596"><a href="#cb66-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-597"><a href="#cb66-597" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to model with only random intercepts</span></span>
<span id="cb66-598"><a href="#cb66-598" aria-hidden="true" tabindex="-1"></a>mixed_model_int <span class="ot">&lt;-</span> <span class="fu">lmer</span>(size <span class="sc">~</span> time <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>individual), <span class="at">data =</span> growth_data)</span>
<span id="cb66-599"><a href="#cb66-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-600"><a href="#cb66-600" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood ratio test</span></span>
<span id="cb66-601"><a href="#cb66-601" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mixed_model_int, mixed_model)</span>
<span id="cb66-602"><a href="#cb66-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-603"><a href="#cb66-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-606"><a href="#cb66-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-607"><a href="#cb66-607" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-mixed-effects</span></span>
<span id="cb66-608"><a href="#cb66-608" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Mixed effects model showing fixed effect (population trend) and random effects (individual variation)"</span></span>
<span id="cb66-609"><a href="#cb66-609" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-610"><a href="#cb66-610" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb66-611"><a href="#cb66-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-612"><a href="#cb66-612" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize random effects</span></span>
<span id="cb66-613"><a href="#cb66-613" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(growth_data, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> size, <span class="at">group =</span> individual)) <span class="sc">+</span></span>
<span id="cb66-614"><a href="#cb66-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb66-615"><a href="#cb66-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb66-616"><a href="#cb66-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(mixed_model)[<span class="dv">1</span>],</span>
<span id="cb66-617"><a href="#cb66-617" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="fu">fixef</span>(mixed_model)[<span class="dv">2</span>],</span>
<span id="cb66-618"><a href="#cb66-618" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb66-619"><a href="#cb66-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mixed Effects Model: Growth Curves"</span>,</span>
<span id="cb66-620"><a href="#cb66-620" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Gray lines show individuals; red line shows population average (fixed effect)"</span>,</span>
<span id="cb66-621"><a href="#cb66-621" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb66-622"><a href="#cb66-622" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Size"</span>) <span class="sc">+</span></span>
<span id="cb66-623"><a href="#cb66-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb66-624"><a href="#cb66-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-625"><a href="#cb66-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-626"><a href="#cb66-626" aria-hidden="true" tabindex="-1"></a><span class="fu">## Split-Plot Designs</span></span>
<span id="cb66-627"><a href="#cb66-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-628"><a href="#cb66-628" aria-hidden="true" tabindex="-1"></a>**Split-plot designs** arise when different factors are applied at different scales or when complete randomization is impractical. Originally developed for agricultural field trials, they're common in biological experiments.</span>
<span id="cb66-629"><a href="#cb66-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-630"><a href="#cb66-630" aria-hidden="true" tabindex="-1"></a>**Structure:**</span>
<span id="cb66-631"><a href="#cb66-631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Whole plots**: Larger experimental units receiving one factor (hard-to-change factor)</span>
<span id="cb66-632"><a href="#cb66-632" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Split plots** (or **subplots**): Smaller units within whole plots receiving another factor (easy-to-change factor)</span>
<span id="cb66-633"><a href="#cb66-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-634"><a href="#cb66-634" aria-hidden="true" tabindex="-1"></a>**Example:** Testing the effect of irrigation (whole plot factor) and fertilizer (split-plot factor) on crop yield. Irrigation is applied to large field plots, while different fertilizers can be applied to smaller areas within each irrigation plot.</span>
<span id="cb66-635"><a href="#cb66-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-636"><a href="#cb66-636" aria-hidden="true" tabindex="-1"></a>**In laboratory settings:**</span>
<span id="cb66-637"><a href="#cb66-637" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Whole plot: Temperature chambers (hard to randomize, limited number)</span>
<span id="cb66-638"><a href="#cb66-638" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Split plot: Different nutrient treatments within each chamber (easy to randomize)</span>
<span id="cb66-639"><a href="#cb66-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-642"><a href="#cb66-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-643"><a href="#cb66-643" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-split-plot</span></span>
<span id="cb66-644"><a href="#cb66-644" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Split-plot design showing hierarchical structure of experimental units"</span></span>
<span id="cb66-645"><a href="#cb66-645" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb66-646"><a href="#cb66-646" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb66-647"><a href="#cb66-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-648"><a href="#cb66-648" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated split-plot design</span></span>
<span id="cb66-649"><a href="#cb66-649" aria-hidden="true" tabindex="-1"></a><span class="co"># Whole plot: Temperature (2 levels, 4 replicates each = 8 chambers)</span></span>
<span id="cb66-650"><a href="#cb66-650" aria-hidden="true" tabindex="-1"></a><span class="co"># Split plot: Nutrient (3 levels per chamber)</span></span>
<span id="cb66-651"><a href="#cb66-651" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">654</span>)</span>
<span id="cb66-652"><a href="#cb66-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-653"><a href="#cb66-653" aria-hidden="true" tabindex="-1"></a>n_chambers_per_temp <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb66-654"><a href="#cb66-654" aria-hidden="true" tabindex="-1"></a>n_nutrients <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb66-655"><a href="#cb66-655" aria-hidden="true" tabindex="-1"></a>n_reps <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># technical replicates within each split plot</span></span>
<span id="cb66-656"><a href="#cb66-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-657"><a href="#cb66-657" aria-hidden="true" tabindex="-1"></a>split_plot_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb66-658"><a href="#cb66-658" aria-hidden="true" tabindex="-1"></a>  <span class="at">temp =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>), <span class="at">each =</span> n_chambers_per_temp)),</span>
<span id="cb66-659"><a href="#cb66-659" aria-hidden="true" tabindex="-1"></a>  <span class="at">chamber =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="dv">2</span> <span class="sc">*</span> n_chambers_per_temp)),</span>
<span id="cb66-660"><a href="#cb66-660" aria-hidden="true" tabindex="-1"></a>  <span class="at">nutrient =</span> <span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="st">"N"</span>, <span class="dv">1</span><span class="sc">:</span>n_nutrients)),</span>
<span id="cb66-661"><a href="#cb66-661" aria-hidden="true" tabindex="-1"></a>  <span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span>n_reps</span>
<span id="cb66-662"><a href="#cb66-662" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb66-663"><a href="#cb66-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-664"><a href="#cb66-664" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_effect =</span> <span class="fu">ifelse</span>(temp <span class="sc">==</span> <span class="st">"Low"</span>, <span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb66-665"><a href="#cb66-665" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Chambers vary even at same temperature (whole plot error)</span></span>
<span id="cb66-666"><a href="#cb66-666" aria-hidden="true" tabindex="-1"></a>    <span class="at">chamber_effect =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="dv">2</span> <span class="sc">*</span> n_chambers_per_temp, <span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb66-667"><a href="#cb66-667" aria-hidden="true" tabindex="-1"></a>                        <span class="at">each =</span> n_nutrients <span class="sc">*</span> n_reps),</span>
<span id="cb66-668"><a href="#cb66-668" aria-hidden="true" tabindex="-1"></a>    <span class="at">nutrient_effect =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>), <span class="at">times =</span> <span class="dv">2</span> <span class="sc">*</span> n_chambers_per_temp <span class="sc">*</span> n_reps),</span>
<span id="cb66-669"><a href="#cb66-669" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interaction between temp and nutrient</span></span>
<span id="cb66-670"><a href="#cb66-670" aria-hidden="true" tabindex="-1"></a>    <span class="at">interaction =</span> <span class="fu">ifelse</span>(temp <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">&amp;</span> nutrient <span class="sc">==</span> <span class="st">"N3"</span>, <span class="dv">3</span>, <span class="dv">0</span>),</span>
<span id="cb66-671"><a href="#cb66-671" aria-hidden="true" tabindex="-1"></a>    <span class="at">yield =</span> <span class="dv">10</span> <span class="sc">+</span> temp_effect <span class="sc">+</span> chamber_effect <span class="sc">+</span> nutrient_effect <span class="sc">+</span></span>
<span id="cb66-672"><a href="#cb66-672" aria-hidden="true" tabindex="-1"></a>            interaction <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb66-673"><a href="#cb66-673" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-674"><a href="#cb66-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-675"><a href="#cb66-675" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize split-plot structure</span></span>
<span id="cb66-676"><a href="#cb66-676" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(split_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> nutrient, <span class="at">y =</span> yield, <span class="at">color =</span> temp)) <span class="sc">+</span></span>
<span id="cb66-677"><a href="#cb66-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="fl">0.2</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb66-678"><a href="#cb66-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb66-679"><a href="#cb66-679" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb66-680"><a href="#cb66-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_se, <span class="at">geom =</span> <span class="st">"errorbar"</span>, <span class="at">width =</span> <span class="fl">0.2</span>,</span>
<span id="cb66-681"><a href="#cb66-681" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb66-682"><a href="#cb66-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> temp) <span class="sc">+</span></span>
<span id="cb66-683"><a href="#cb66-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Split-Plot Design: Temperature (whole plot) × Nutrient (split plot)"</span>,</span>
<span id="cb66-684"><a href="#cb66-684" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Temperature applied to whole chambers; nutrients varied within chambers"</span>,</span>
<span id="cb66-685"><a href="#cb66-685" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Nutrient Level (Split-Plot Factor)"</span>,</span>
<span id="cb66-686"><a href="#cb66-686" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Yield"</span>,</span>
<span id="cb66-687"><a href="#cb66-687" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Temperature</span><span class="sc">\n</span><span class="st">(Whole-Plot)"</span>) <span class="sc">+</span></span>
<span id="cb66-688"><a href="#cb66-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>)</span>
<span id="cb66-689"><a href="#cb66-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-690"><a href="#cb66-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-693"><a href="#cb66-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-694"><a href="#cb66-694" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis of split-plot design</span></span>
<span id="cb66-695"><a href="#cb66-695" aria-hidden="true" tabindex="-1"></a><span class="co"># Whole plot factor: temperature (tested against chamber error)</span></span>
<span id="cb66-696"><a href="#cb66-696" aria-hidden="true" tabindex="-1"></a><span class="co"># Split plot factor: nutrient (tested against split-plot error)</span></span>
<span id="cb66-697"><a href="#cb66-697" aria-hidden="true" tabindex="-1"></a><span class="co"># Use mixed model with chamber as random effect</span></span>
<span id="cb66-698"><a href="#cb66-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-699"><a href="#cb66-699" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb66-700"><a href="#cb66-700" aria-hidden="true" tabindex="-1"></a>split_plot_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(yield <span class="sc">~</span> temp <span class="sc">*</span> nutrient <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>chamber),</span>
<span id="cb66-701"><a href="#cb66-701" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> split_plot_data)</span>
<span id="cb66-702"><a href="#cb66-702" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(split_plot_model)</span>
<span id="cb66-703"><a href="#cb66-703" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(split_plot_model)</span>
<span id="cb66-704"><a href="#cb66-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-705"><a href="#cb66-705" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: The whole-plot factor (temp) has fewer degrees of freedom</span></span>
<span id="cb66-706"><a href="#cb66-706" aria-hidden="true" tabindex="-1"></a><span class="co"># because it varies only among chambers, not within them</span></span>
<span id="cb66-707"><a href="#cb66-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-708"><a href="#cb66-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-709"><a href="#cb66-709" aria-hidden="true" tabindex="-1"></a>**Key features of split-plot analysis:**</span>
<span id="cb66-710"><a href="#cb66-710" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different error terms for whole-plot and split-plot factors</span>
<span id="cb66-711"><a href="#cb66-711" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Whole-plot tests have fewer degrees of freedom (less powerful)</span>
<span id="cb66-712"><a href="#cb66-712" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Split-plot tests are more powerful (more replication)</span>
<span id="cb66-713"><a href="#cb66-713" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Interactions use split-plot error term</span>
<span id="cb66-714"><a href="#cb66-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-715"><a href="#cb66-715" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Considerations for Complex Designs</span></span>
<span id="cb66-716"><a href="#cb66-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-717"><a href="#cb66-717" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sample Size and Power</span></span>
<span id="cb66-718"><a href="#cb66-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-719"><a href="#cb66-719" aria-hidden="true" tabindex="-1"></a>Complex designs require careful power analysis. The power for detecting:</span>
<span id="cb66-720"><a href="#cb66-720" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Main effects** depends on the number of replicates and effect size</span>
<span id="cb66-721"><a href="#cb66-721" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interactions** is typically lower than for main effects—interactions require larger samples</span>
<span id="cb66-722"><a href="#cb66-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-723"><a href="#cb66-723" aria-hidden="true" tabindex="-1"></a>Use simulation-based power analysis for complex designs where analytical solutions are difficult.</span>
<span id="cb66-724"><a href="#cb66-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-725"><a href="#cb66-725" aria-hidden="true" tabindex="-1"></a><span class="fu">### Balanced vs Unbalanced Designs</span></span>
<span id="cb66-726"><a href="#cb66-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-727"><a href="#cb66-727" aria-hidden="true" tabindex="-1"></a>**Balanced designs** (equal sample sizes in all cells) are preferable:</span>
<span id="cb66-728"><a href="#cb66-728" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simpler interpretation</span>
<span id="cb66-729"><a href="#cb66-729" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Greater statistical power</span>
<span id="cb66-730"><a href="#cb66-730" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Robust to assumption violations</span>
<span id="cb66-731"><a href="#cb66-731" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Easier to test for interactions</span>
<span id="cb66-732"><a href="#cb66-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-733"><a href="#cb66-733" aria-hidden="true" tabindex="-1"></a>**Unbalanced designs** complicate analysis:</span>
<span id="cb66-734"><a href="#cb66-734" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Type I, II, and III sums of squares give different results</span>
<span id="cb66-735"><a href="#cb66-735" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Main effects and interactions are correlated</span>
<span id="cb66-736"><a href="#cb66-736" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reduced power for some effects</span>
<span id="cb66-737"><a href="#cb66-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-738"><a href="#cb66-738" aria-hidden="true" tabindex="-1"></a>When unavoidable, use Type III sums of squares with caution and consider mixed effects models.</span>
<span id="cb66-739"><a href="#cb66-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-740"><a href="#cb66-740" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect Sizes in Multi-Factor ANOVA</span></span>
<span id="cb66-741"><a href="#cb66-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-742"><a href="#cb66-742" aria-hidden="true" tabindex="-1"></a>Report effect sizes for all significant effects:</span>
<span id="cb66-743"><a href="#cb66-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-744"><a href="#cb66-744" aria-hidden="true" tabindex="-1"></a>**Partial eta-squared** ($\eta^2_p$): Proportion of variance explained by each effect, removing variance from other effects:</span>
<span id="cb66-745"><a href="#cb66-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-746"><a href="#cb66-746" aria-hidden="true" tabindex="-1"></a>$$\eta^2_p = \frac{SS_{effect}}{SS_{effect} + SS_{error}}$$</span>
<span id="cb66-747"><a href="#cb66-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-750"><a href="#cb66-750" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-751"><a href="#cb66-751" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate effect sizes from factorial ANOVA</span></span>
<span id="cb66-752"><a href="#cb66-752" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effectsize)</span>
<span id="cb66-753"><a href="#cb66-753" aria-hidden="true" tabindex="-1"></a><span class="fu">eta_squared</span>(factorial_aov, <span class="at">partial =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-754"><a href="#cb66-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-755"><a href="#cb66-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-756"><a href="#cb66-756" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiple Comparisons</span></span>
<span id="cb66-757"><a href="#cb66-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-758"><a href="#cb66-758" aria-hidden="true" tabindex="-1"></a>With many factor levels and combinations, multiple comparison corrections become crucial:</span>
<span id="cb66-759"><a href="#cb66-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-762"><a href="#cb66-762" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-763"><a href="#cb66-763" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc comparisons for factorial design</span></span>
<span id="cb66-764"><a href="#cb66-764" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb66-765"><a href="#cb66-765" aria-hidden="true" tabindex="-1"></a>factorial_emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(factorial_aov, <span class="sc">~</span> temperature <span class="sc">*</span> nutrient)</span>
<span id="cb66-766"><a href="#cb66-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-767"><a href="#cb66-767" aria-hidden="true" tabindex="-1"></a><span class="co"># All pairwise comparisons</span></span>
<span id="cb66-768"><a href="#cb66-768" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(factorial_emm, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span>
<span id="cb66-769"><a href="#cb66-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-770"><a href="#cb66-770" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple effects: nutrient effect at each temperature</span></span>
<span id="cb66-771"><a href="#cb66-771" aria-hidden="true" tabindex="-1"></a>nutrient_simple <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(factorial_aov, <span class="sc">~</span> nutrient <span class="sc">|</span> temperature)</span>
<span id="cb66-772"><a href="#cb66-772" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(nutrient_simple, <span class="at">adjust =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb66-773"><a href="#cb66-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-774"><a href="#cb66-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-775"><a href="#cb66-775" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model Assumptions</span></span>
<span id="cb66-776"><a href="#cb66-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-777"><a href="#cb66-777" aria-hidden="true" tabindex="-1"></a>Check assumptions for all error terms in complex designs:</span>
<span id="cb66-778"><a href="#cb66-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-781"><a href="#cb66-781" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb66-782"><a href="#cb66-782" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diagnostic-plots</span></span>
<span id="cb66-783"><a href="#cb66-783" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Diagnostic plots for checking ANOVA assumptions"</span></span>
<span id="cb66-784"><a href="#cb66-784" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb66-785"><a href="#cb66-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb66-786"><a href="#cb66-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-787"><a href="#cb66-787" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic plots</span></span>
<span id="cb66-788"><a href="#cb66-788" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb66-789"><a href="#cb66-789" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(factorial_aov)</span>
<span id="cb66-790"><a href="#cb66-790" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb66-791"><a href="#cb66-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-792"><a href="#cb66-792" aria-hidden="true" tabindex="-1"></a><span class="co"># Test homogeneity of variance</span></span>
<span id="cb66-793"><a href="#cb66-793" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb66-794"><a href="#cb66-794" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(growth <span class="sc">~</span> temperature <span class="sc">*</span> nutrient, <span class="at">data =</span> factorial_data)</span>
<span id="cb66-795"><a href="#cb66-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-796"><a href="#cb66-796" aria-hidden="true" tabindex="-1"></a><span class="co"># Test normality of residuals</span></span>
<span id="cb66-797"><a href="#cb66-797" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(factorial_aov))</span>
<span id="cb66-798"><a href="#cb66-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb66-799"><a href="#cb66-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-800"><a href="#cb66-800" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reporting Results</span></span>
<span id="cb66-801"><a href="#cb66-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-802"><a href="#cb66-802" aria-hidden="true" tabindex="-1"></a>When reporting multi-factor ANOVA results, include:</span>
<span id="cb66-803"><a href="#cb66-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-804"><a href="#cb66-804" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Descriptive statistics** for each cell (means, SDs, sample sizes)</span>
<span id="cb66-805"><a href="#cb66-805" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**ANOVA table** with F-values, degrees of freedom, and p-values for all effects</span>
<span id="cb66-806"><a href="#cb66-806" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Effect sizes** (partial eta-squared or omega-squared)</span>
<span id="cb66-807"><a href="#cb66-807" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Post-hoc tests** or simple effects when interactions are significant</span>
<span id="cb66-808"><a href="#cb66-808" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Diagnostic plots** confirming assumptions (in supplementary materials)</span>
<span id="cb66-809"><a href="#cb66-809" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Graphical display** of means with error bars (interaction plots for two-way designs)</span>
<span id="cb66-810"><a href="#cb66-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-811"><a href="#cb66-811" aria-hidden="true" tabindex="-1"></a>Example reporting:</span>
<span id="cb66-812"><a href="#cb66-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-813"><a href="#cb66-813" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We conducted a 2 × 2 factorial ANOVA to examine the effects of temperature (low vs. high) and nutrient level (low vs. high) on algal growth rate. There was a significant main effect of temperature, F(1, 56) = 45.2, p &lt; .001, $\eta^2_p$ = 0.45, and a significant main effect of nutrient level, F(1, 56) = 89.7, p &lt; .001, $\eta^2_p$ = 0.62. Critically, there was a significant temperature × nutrient interaction, F(1, 56) = 12.3, p &lt; .001, $\eta^2_p$ = 0.18. Simple effects analysis revealed that the nutrient effect was significant at both temperatures (both p &lt; .001), but the magnitude was greater at high temperature (Δ = 9.1 units) than at low temperature (Δ = 5.2 units).</span></span>
<span id="cb66-814"><a href="#cb66-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-815"><a href="#cb66-815" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb66-816"><a href="#cb66-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-817"><a href="#cb66-817" aria-hidden="true" tabindex="-1"></a>Multi-factor ANOVA extends the basic ANOVA framework to designs with multiple factors:</span>
<span id="cb66-818"><a href="#cb66-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-819"><a href="#cb66-819" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Factorial designs** test all combinations of factor levels, allowing estimation of main effects and interactions</span>
<span id="cb66-820"><a href="#cb66-820" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interactions** reveal that factors do not operate independently—the effect of one factor depends on another</span>
<span id="cb66-821"><a href="#cb66-821" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Interaction plots** with non-parallel lines indicate interactions; interpret simple effects rather than main effects when interactions are significant</span>
<span id="cb66-822"><a href="#cb66-822" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**ANCOVA** combines categorical factors with continuous covariates, controlling for baseline variation and increasing statistical power</span>
<span id="cb66-823"><a href="#cb66-823" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Nested designs** have hierarchical structure where levels of one factor exist only within another; common in hierarchical sampling</span>
<span id="cb66-824"><a href="#cb66-824" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Repeated measures ANOVA** accounts for correlation when the same subjects are measured multiple times</span>
<span id="cb66-825"><a href="#cb66-825" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Mixed effects models** include both fixed and random effects, providing flexibility for complex data structures</span>
<span id="cb66-826"><a href="#cb66-826" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Split-plot designs** arise when factors are applied at different scales or complete randomization is impractical</span>
<span id="cb66-827"><a href="#cb66-827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Always report effect sizes, check assumptions, and use appropriate corrections for multiple comparisons</span>
<span id="cb66-828"><a href="#cb66-828" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Balanced designs are preferable but mixed effects models can handle unbalanced data</span>
<span id="cb66-829"><a href="#cb66-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-830"><a href="#cb66-830" aria-hidden="true" tabindex="-1"></a>Understanding when and how to use multi-factor ANOVA is essential for designing efficient experiments and extracting maximum information from biological data. The ability to test for interactions is particularly valuable—discovering that factors interact often leads to deeper biological insights than finding main effects alone.</span>
<span id="cb66-831"><a href="#cb66-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-832"><a href="#cb66-832" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practice Exercises</span></span>
<span id="cb66-833"><a href="#cb66-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-834"><a href="#cb66-834" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Design Question**: You want to test the effect of three fertilizer types (A, B, C) and two watering regimes (low, high) on plant growth.</span>
<span id="cb66-835"><a href="#cb66-835" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How many treatment combinations are in this design?</span>
<span id="cb66-836"><a href="#cb66-836" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Draw a diagram showing all treatment groups</span>
<span id="cb66-837"><a href="#cb66-837" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Is this a balanced design if you have 10 plants per treatment?</span>
<span id="cb66-838"><a href="#cb66-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-839"><a href="#cb66-839" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Interaction Interpretation**: An experiment tests the effect of drug (present vs. absent) and exercise (yes vs. no) on weight loss. The means are:</span>
<span id="cb66-840"><a href="#cb66-840" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>No drug, no exercise: 2 kg lost</span>
<span id="cb66-841"><a href="#cb66-841" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>No drug, exercise: 5 kg lost</span>
<span id="cb66-842"><a href="#cb66-842" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Drug, no exercise: 6 kg lost</span>
<span id="cb66-843"><a href="#cb66-843" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Drug + exercise: 8 kg lost</span>
<span id="cb66-844"><a href="#cb66-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-845"><a href="#cb66-845" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Sketch an interaction plot</span>
<span id="cb66-846"><a href="#cb66-846" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Is there an interaction? How do you know?</span>
<span id="cb66-847"><a href="#cb66-847" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Interpret the results in practical terms</span>
<span id="cb66-848"><a href="#cb66-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-849"><a href="#cb66-849" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Data Analysis**: Using the built-in <span class="in">`ToothGrowth`</span> dataset in R, which examines the effect of Vitamin C dose (0.5, 1.0, 2.0 mg) and delivery method (orange juice vs. ascorbic acid) on tooth length in guinea pigs:</span>
<span id="cb66-850"><a href="#cb66-850" aria-hidden="true" tabindex="-1"></a>   <span class="in">```r</span></span>
<span id="cb66-851"><a href="#cb66-851" aria-hidden="true" tabindex="-1"></a>   <span class="fu">data</span>(ToothGrowth)</span>
<span id="cb66-852"><a href="#cb66-852" aria-hidden="true" tabindex="-1"></a>   <span class="in">```</span></span>
<span id="cb66-853"><a href="#cb66-853" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Conduct a two-way ANOVA</span>
<span id="cb66-854"><a href="#cb66-854" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Create an interaction plot</span>
<span id="cb66-855"><a href="#cb66-855" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Is there a significant interaction?</span>
<span id="cb66-856"><a href="#cb66-856" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Calculate effect sizes</span>
<span id="cb66-857"><a href="#cb66-857" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Write a brief results paragraph</span>
<span id="cb66-858"><a href="#cb66-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-859"><a href="#cb66-859" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Nested vs. Crossed**: For each scenario, identify whether the design is nested or crossed:</span>
<span id="cb66-860"><a href="#cb66-860" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>(a) Students within schools, testing two teaching methods across all schools</span>
<span id="cb66-861"><a href="#cb66-861" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>(b) Patients within clinics, with each clinic using all three drug treatments</span>
<span id="cb66-862"><a href="#cb66-862" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>(c) Leaves within trees, where trees are sampled from three different forests</span>
<span id="cb66-863"><a href="#cb66-863" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>(d) Two temperature conditions and three light conditions, all combinations tested</span>
<span id="cb66-864"><a href="#cb66-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-865"><a href="#cb66-865" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Repeated Measures**: Design a repeated measures experiment to test whether a new drug reduces anxiety over time.</span>
<span id="cb66-866"><a href="#cb66-866" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Specify your factors and levels</span>
<span id="cb66-867"><a href="#cb66-867" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How many participants would you need for 80% power?</span>
<span id="cb66-868"><a href="#cb66-868" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What would your repeated measure be?</span>
<span id="cb66-869"><a href="#cb66-869" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What assumptions must you check?</span>
<span id="cb66-870"><a href="#cb66-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-871"><a href="#cb66-871" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>**Sample Size**: In a 3 × 2 factorial design:</span>
<span id="cb66-872"><a href="#cb66-872" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How many treatment combinations exist?</span>
<span id="cb66-873"><a href="#cb66-873" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>If you want 20 observations per cell, how many total observations do you need?</span>
<span id="cb66-874"><a href="#cb66-874" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Which effect (main or interaction) typically requires larger sample sizes to detect?</span>
<span id="cb66-875"><a href="#cb66-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-876"><a href="#cb66-876" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>**Mixed Effects Application**: You measure bacterial growth in 20 Petri dishes, with 5 measurements per dish across four timepoints.</span>
<span id="cb66-877"><a href="#cb66-877" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What is the fixed effect?</span>
<span id="cb66-878"><a href="#cb66-878" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What is the random effect?</span>
<span id="cb66-879"><a href="#cb66-879" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Write the <span class="in">`lmer()`</span> model formula</span>
<span id="cb66-880"><a href="#cb66-880" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Why is a mixed effects model appropriate here?</span>
<span id="cb66-881"><a href="#cb66-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-882"><a href="#cb66-882" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>**Practical Design**: You have access to 4 growth chambers and want to test 3 light conditions and 2 CO₂ levels.</span>
<span id="cb66-883"><a href="#cb66-883" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Why might a split-plot design be necessary?</span>
<span id="cb66-884"><a href="#cb66-884" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Which factor should be the whole-plot factor? Why?</span>
<span id="cb66-885"><a href="#cb66-885" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Sketch the design layout</span>
<span id="cb66-886"><a href="#cb66-886" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What are the implications for statistical power?</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Statistics for Biosciences and Bioengineering</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>