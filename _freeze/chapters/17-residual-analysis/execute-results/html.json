{
  "hash": "19ba5ffe0b65a715e03d4b51c8644b5e",
  "result": {
    "engine": "knitr",
    "markdown": "# Residual Analysis {#sec-residual-analysis}\n\n\n::: {.cell}\n\n:::\n\n\n## What Are Residuals?\n\nResiduals are the differences between observed values and values predicted by the model:\n\n$$e_i = y_i - \\hat{y}_i$$\n\nThey represent the part of the data not explained by the model—the \"leftover\" variation. Analyzing residuals helps us check whether the assumptions of our model are met and identify potential problems.\n\n![](../images/images_4b.016.jpeg){fig-align=\"center\"}\n\n## Why Residual Analysis Matters\n\nA regression model might fit the data well according to R-squared while still being inappropriate. The model might capture the wrong pattern, miss non-linear relationships, or be unduly influenced by outliers. Residual analysis reveals these problems.\n\nRemember Anscombe's Quartet—four datasets with identical regression lines but very different patterns. Looking only at the regression output would miss these differences entirely.\n\n![](../images/images_4b.017.jpeg){fig-align=\"center\"}\n\n## Checking Assumptions\n\n### Linearity\n\nIf the relationship is truly linear, residuals should show no systematic pattern when plotted against fitted values or the predictor variable. A curved pattern suggests non-linearity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create data with non-linear relationship\nset.seed(42)\nx <- seq(0, 10, length.out = 100)\ny <- 2 + 0.5 * x + 0.1 * x^2 + rnorm(100, sd = 1)\n\nmodel <- lm(y ~ x)\n\npar(mfrow = c(1, 2))\nplot(x, y, main = \"Data with Quadratic Pattern\")\nabline(model, col = \"red\")\n\nplot(fitted(model), residuals(model), \n     main = \"Residuals vs Fitted\",\n     xlab = \"Fitted values\", ylab = \"Residuals\")\nabline(h = 0, col = \"red\", lty = 2)\n```\n\n::: {.cell-output-display}\n![](17-residual-analysis_files/figure-html/unnamed-chunk-2-1.png){width=768}\n:::\n:::\n\n\nThe curved pattern in the residual plot reveals that a linear model is inadequate.\n\n### Normality\n\nResiduals should be approximately normally distributed. Check with a histogram or Q-Q plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Good model for comparison\nx2 <- rnorm(100)\ny2 <- 2 + 3 * x2 + rnorm(100)\ngood_model <- lm(y2 ~ x2)\n\npar(mfrow = c(1, 2))\nhist(residuals(good_model), breaks = 20, main = \"Histogram of Residuals\",\n     xlab = \"Residuals\", col = \"lightblue\")\nqqnorm(residuals(good_model))\nqqline(residuals(good_model), col = \"red\")\n```\n\n::: {.cell-output-display}\n![](17-residual-analysis_files/figure-html/unnamed-chunk-3-1.png){width=768}\n:::\n:::\n\n\nPoints on the Q-Q plot should fall approximately along the diagonal line. Systematic departures indicate non-normality.\n\n### Homoscedasticity\n\nResiduals should have constant variance across the range of fitted values. A fan or cone shape indicates heteroscedasticity (unequal variance).\n\n![](../images/images_4b.020.jpeg){fig-align=\"center\"}\n\n### Independence\n\nResiduals should be independent of each other. This is hard to check visually but is violated when observations are related (e.g., repeated measurements on the same subjects, or time series data).\n\n## Diagnostic Plots in R\n\nR provides built-in diagnostic plots for linear models:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Standard diagnostic plots\npar(mfrow = c(2, 2))\nplot(good_model)\n```\n\n::: {.cell-output-display}\n![](17-residual-analysis_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\nThese four plots show:\n1. **Residuals vs Fitted**: Check for linearity and homoscedasticity\n2. **Q-Q Plot**: Check for normality\n3. **Scale-Location**: Check for homoscedasticity\n4. **Residuals vs Leverage**: Identify influential points\n\n## Leverage and Influence\n\nNot all observations affect the regression equally. **Leverage** measures how unusual an observation's X value is—points with extreme X values have more potential to influence the fitted line.\n\n**Cook's Distance** measures how much the regression would change if an observation were removed. High Cook's D values indicate influential points that merit closer examination.\n\n![](../images/images_4b.021.jpeg){fig-align=\"center\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check for influential points\ninfluence.measures(good_model)$is.inf[1:5,]  # First 5 observations\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  dfb.1_ dfb.x2 dffit cov.r cook.d   hat\n1  FALSE  FALSE FALSE FALSE  FALSE FALSE\n2  FALSE  FALSE FALSE FALSE  FALSE FALSE\n3  FALSE  FALSE FALSE FALSE  FALSE FALSE\n4  FALSE  FALSE  TRUE FALSE  FALSE FALSE\n5  FALSE  FALSE FALSE FALSE  FALSE FALSE\n```\n\n\n:::\n:::\n\n\n## Handling Violations\n\nWhen assumptions are violated, several approaches may help:\n\n**Transform the data**: Log, square root, or other transformations can stabilize variance and improve linearity.\n\n**Use robust regression**: Methods like `rlm()` from the MASS package down-weight influential observations.\n\n**Try a different model**: Non-linear regression, generalized linear models, or generalized additive models may be more appropriate.\n\n**Remove outliers**: Only if you have substantive reasons—never simply to improve fit.\n\n## Residual Analysis Workflow\n\nA systematic approach to residual analysis:\n\n1. Fit the model\n2. Generate diagnostic plots\n3. Check for patterns in residuals vs. fitted values\n4. Examine the Q-Q plot for normality\n5. Look for influential points\n6. If problems exist, consider transformations or alternative models\n7. Re-check diagnostics after any changes\n\nResidual analysis is not optional—it is an essential part of any regression analysis. Models that look good on paper may tell misleading stories if their assumptions are violated.\n",
    "supporting": [
      "17-residual-analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}